<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.6.1">
<meta name="description" content="openEHR Archetype Query Language (AQL)">
<meta name="keywords" content="query, AQL, archetype, Xpath">
<title>Archetype Query Language (AQL)</title>
<link rel="stylesheet" href="https://specifications.openehr.org/styles/openehr.css">
<link rel="stylesheet" href="https://specifications.openehr.org/styles/pygments-default.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel0">
<li><a href="#_archetype_query_language_aql">Archetype Query Language (AQL)</a>
<ul class="sectlevel1">
<li><a href="#_amendment_record">Amendment Record</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a>
<ul class="sectlevel2">
<li><a href="#_primary_author">Primary Author</a></li>
<li><a href="#_contributors">Contributors</a></li>
<li><a href="#_support">Support</a></li>
<li><a href="#_trademarks">Trademarks</a></li>
</ul>
</li>
<li><a href="#_preface">1. Preface</a>
<ul class="sectlevel2">
<li><a href="#_purpose">1.1. Purpose</a></li>
<li><a href="#_status">1.2. Status</a></li>
<li><a href="#_feedback">1.3. Feedback</a></li>
<li><a href="#_original_source">1.4. Original Source</a></li>
<li><a href="#_tooling_status">1.5. Tooling status</a>
<ul class="sectlevel3">
<li><a href="#_aql_features_not_yet_supported">1.5.1. AQL features not yet supported</a></li>
<li><a href="#_aql_features_that_are_proposed_but_not_finalised">1.5.2. AQL features that are proposed, but not finalised</a>
<ul class="sectlevel4">
<li><a href="#_arithmetic_functions">1.5.2.1. Arithmetic functions</a></li>
<li><a href="#_other_functions">1.5.2.2. Other functions</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_further_discussions">1.6. Further discussions</a></li>
</ul>
</li>
<li><a href="#_overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_existing_query_languages">2.1. Existing Query Languages</a></li>
<li><a href="#_what_is_aql">2.2. What is AQL?</a></li>
<li><a href="#_structure_example">2.3. Structure &amp; Example</a></li>
</ul>
</li>
<li><a href="#_aql_syntax_description">3. AQL Syntax Description</a>
<ul class="sectlevel2">
<li><a href="#_overview_2">3.1. Overview</a></li>
<li><a href="#_reserved_words_and_characters">3.2. Reserved words and characters</a></li>
<li><a href="#_openehr_path_syntax">3.3. openEHR path syntax</a>
<ul class="sectlevel3">
<li><a href="#_openehr_path_examples_archetype_path">3.3.1. openEHR path examples - archetype path</a></li>
<li><a href="#_openehr_path_examples_path_to_rm_class_attributes">3.3.2. openEHR path examples - path to RM class attributes</a></li>
</ul>
</li>
<li><a href="#_aql_variables">3.4. AQL variables</a></li>
<li><a href="#_parameters">3.5. Parameters</a>
<ul class="sectlevel3">
<li><a href="#_when_parameters_are_needed">3.5.1. When parameters are needed</a></li>
<li><a href="#_where_and_how_parameters_are_resolved">3.5.2. Where and how parameters are resolved</a></li>
<li><a href="#_parameter_syntax">3.5.3. Parameter syntax</a></li>
</ul>
</li>
<li><a href="#_predicates">3.6. Predicates</a>
<ul class="sectlevel3">
<li><a href="#_standard_predicate">3.6.1. Standard predicate</a></li>
<li><a href="#_archetype_predicate">3.6.2. Archetype predicate</a></li>
<li><a href="#_node_predicate">3.6.3. Node predicate</a></li>
</ul>
</li>
<li><a href="#_operators">3.7. Operators</a>
<ul class="sectlevel3">
<li><a href="#_basic_operators">3.7.1. Basic operators</a></li>
<li><a href="#_advanced_operators">3.7.2. Advanced operators</a>
<ul class="sectlevel4">
<li><a href="#_matches">3.7.2.1. matches</a></li>
<li><a href="#_exists">3.7.2.2. EXISTS</a></li>
<li><a href="#_not">3.7.2.3. NOT</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_aql_identified_paths">3.8. AQL identified paths</a>
<ul class="sectlevel3">
<li><a href="#_usage">3.8.1. Usage</a></li>
<li><a href="#_syntax">3.8.2. Syntax</a></li>
</ul>
</li>
<li><a href="#_leaf_data">3.9. Leaf Data</a>
<ul class="sectlevel3">
<li><a href="#_primitive_types">3.9.1. Primitive Types</a>
<ul class="sectlevel4">
<li><a href="#_string_data">3.9.1.1. String Data</a></li>
<li><a href="#_integer_data">3.9.1.2. Integer data</a></li>
<li><a href="#_real_data">3.9.1.3. Real data</a></li>
<li><a href="#_boolean_data">3.9.1.4. Boolean data</a></li>
<li><a href="#_dates_and_times">3.9.1.5. Dates and Times</a></li>
</ul>
</li>
<li><a href="#_other_built_in_types">3.9.2. Other Built-in Types</a>
<ul class="sectlevel4">
<li><a href="#_uri">3.9.2.1. URI</a></li>
<li><a href="#_terminology_uri">3.9.2.2. Terminology URI</a></li>
<li><a href="#_value_list">3.9.2.3. Value List</a></li>
<li><a href="#_value_range">3.9.2.4. Value Range</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_query_structure">3.10. Query structure</a>
<ul class="sectlevel3">
<li><a href="#_overview_3">3.10.1. Overview</a></li>
<li><a href="#_from">3.10.2. FROM</a>
<ul class="sectlevel4">
<li><a href="#_from_syntax">3.10.2.1. FROM Syntax</a></li>
<li><a href="#_class_expressions">3.10.2.2. Class expressions</a></li>
<li><a href="#_containment">3.10.2.3. Containment</a></li>
</ul>
</li>
<li><a href="#_where">3.10.3. WHERE</a>
<ul class="sectlevel4">
<li><a href="#_syntax_2">3.10.3.1. Syntax</a></li>
<li><a href="#_identified_expression">3.10.3.2. Identified expression</a></li>
</ul>
</li>
<li><a href="#_select">3.10.4. SELECT</a>
<ul class="sectlevel4">
<li><a href="#_top">3.10.4.1. TOP</a></li>
<li><a href="#_name_alias">3.10.4.2. Name alias</a></li>
</ul>
</li>
<li><a href="#_order_by">3.10.5. ORDER BY</a></li>
<li><a href="#_timewindow">3.10.6. TIMEWINDOW</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_result_structure">4. Result structure</a></li>
<li><a href="#_aql_operator_syntax_examples">5. AQL Operator Syntax Examples</a>
<ul class="sectlevel2">
<li><a href="#_adl_matches_operator">5.1. ADL matches operator</a></li>
<li><a href="#_arithmetic_operators">5.2. Arithmetic operators</a></li>
<li><a href="#_nest_query_and_not_in">5.3. Nest Query and 'Not in'</a></li>
<li><a href="#_exists_operator">5.4. Exists operator</a></li>
</ul>
</li>
<li><a href="#_how_to_write_an_aql_query_statement_manually">6. How to write an AQL query statement manually</a>
<ul class="sectlevel2">
<li><a href="#_query_scenario">6.1. Query scenario</a></li>
<li><a href="#_step_1_the_from_clause">6.2. Step 1. The FROM clause</a></li>
<li><a href="#_step_2_the_where_clause">6.3. Step 2. The WHERE clause</a></li>
<li><a href="#_step_3_the_select_clause">6.4. Step 3. The SELECT clause</a></li>
</ul>
</li>
<li><a href="#_aql_syntax_specification">7. AQL Syntax Specification</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="https://specifications.openehr.org/images/openehr_logo_large.png" alt="openEHR logo">
</div>
</div>
</div>
</div>
<h1 id="_archetype_query_language_aql" class="sect0">Archetype Query Language (AQL)</h1>
<div class="openblock partintro">
<div class="content">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2"><strong>Issuer</strong>: <a href="https://www.openehr.org/programs/specification/">openEHR Specification Program</a></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Release</strong>: latest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Status</strong>: STABLE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Revision</strong>: <a href="#latest_issue">[latest_issue]</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Date</strong>: <a href="#latest_issue_date">[latest_issue_date]</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><strong>Keywords</strong>: query, AQL, archetype, Xpath</p></td>
</tr>
</tbody>
</table>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="openehr_block_diagram.svg" alt="openEHR components" width="60%">
</div>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top" colspan="2">&#169; 2008 - 2018 The openEHR Foundation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock"><a href="/" target="_blank" rel="noopener">The openEHR Foundation</a> is an independent, non-profit community organisation, facilitating the sharing of health records by consumers and clinicians via open-source, standards-based implementations.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Licence</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><span class="image"><img src="https://specifications.openehr.org/images/cc-by-nd-88x31.png" alt="image"></span> Creative Commons Attribution-NoDerivs 3.0 Unported. <a href="https://creativecommons.org/licenses/by-nd/3.0/" class="bare">https://creativecommons.org/licenses/by-nd/3.0/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Support</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issues: <a href="https://specifications.openehr.org/components/QUERY/open_issues" target="_blank" rel="noopener">Problem Reports</a><br>
 Web: <a href="/" target="_blank" rel="noopener">www.openehr.org</a></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_amendment_record">Amendment Record</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 54.5454%;">
<col style="width: 18.1818%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Issue</th>
<th class="tableblock halign-left valign-top">Details</th>
<th class="tableblock halign-left valign-top">Raiser</th>
<th class="tableblock halign-left valign-top">Completed</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>R E L E A S E&#160;&#160;&#160;&#160;&#160;1.0.2</strong></p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue"></a>1.0.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://specifications.openehr.org/tickets/SPECQUERY-6" target="_blank" rel="noopener">SPECQUERY-6</a> Publish original AQL wiki page as formal specification;<br>
 Various reformatting, adjustment of headings;<br>
 Fix missing square brackets on query example. (<a href="https://specifications.openehr.org/tickets/SPECPR-236" target="_blank" rel="noopener">SPECPR-236</a>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">openEHR SEC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="latest_issue_date"></a>10 Jan 2017</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Add Antlr grammar for AQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B Lah</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13 Jan 2012</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial Writing, based on <a href="https://openehr.atlassian.net/wiki/display/spec/Archetype+Query+Language+Description">openEHR AQL wiki page</a>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C Ma<br>
 H Frankel<br>
 T Beale</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 Dec 2008</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_acknowledgements">Acknowledgements</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_primary_author">Primary Author</h3>
<div class="ulist">
<ul>
<li>
<p>Chunlan Ma, MD, Ocean Informatics, Australia.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_contributors">Contributors</h3>
<div class="paragraph">
<p>This specification benefited from wide formal and informal input from the openEHR and wider health informatics community. The openEHR Foundation would like to recognise the following people for their contributions.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Heath Frankel, Ocean Informatics, Australia</p>
</li>
<li>
<p>Bostjan Lah, Architect, Marand, Slovenia</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_support">Support</h3>
<div class="paragraph">
<p>The work reported in this paper has been funded by the following organisations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ocean Informatics, Australia</p>
</li>
<li>
<p>Marand, Slovenia</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_trademarks">Trademarks</h3>
<div class="ulist">
<ul>
<li>
<p>'openEHR' is a trademark of the openEHR Foundation</p>
</li>
<li>
<p>'Java' is a registered trademark of Oracle Corporation</p>
</li>
<li>
<p>'Microsoft' and '.Net' are trademarks of the Microsoft Corporation</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>1. Preface</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose"><a class="anchor" href="#_purpose"></a>1.1. Purpose</h3>
<div class="paragraph">
<p>This document describes the syntax of the openEHR Archetype Query Language (AQL).</p>
</div>
</div>
<div class="sect2">
<h3 id="_status"><a class="anchor" href="#_status"></a>1.2. Status</h3>
<div class="paragraph">
<p>This specification is in the STABLE state. The latest development version of this document can be found at <a href="https://specifications.openehr.org/releases/QUERY/latest/AQL.html" target="_blank" rel="noopener">https://specifications.openehr.org/releases/QUERY/latest/AQL.html</a>.</p>
</div>
<div class="paragraph">
<p>Known omissions or questions are indicated in the text with a 'to be determined' paragraph, as follows:</p>
</div>
<div class="paragraph tbd">
<p><strong>TBD</strong>: (example To Be Determined paragraph)</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback"><a class="anchor" href="#_feedback"></a>1.3. Feedback</h3>
<div class="paragraph">
<p>Feedback may be provided on the <a href="http://lists.openehr.org/mailman/listinfo/openehr-technical_lists.openehr.org" target="_blank" rel="noopener">technical mailing list</a>.</p>
</div>
<div class="paragraph">
<p>Issues may be raised on the <a href="https://specifications.openehr.org/components/QUERY/open_issues" target="_blank" rel="noopener">specifications Problem Report tracker</a>.</p>
</div>
<div class="paragraph">
<p>To see changes made due to previously reported issues, see the <a href="https://specifications.openehr.org/components/QUERY/history" target="_blank" rel="noopener">QUERY component Change Request tracker</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_original_source"><a class="anchor" href="#_original_source"></a>1.4. Original Source</h3>
<div class="paragraph">
<p>The text of this specification was originally posted on the <a href="https://specifications.openehr.org/wiki/spaces/spec/pages/4915203/AQL-+Archetype+Query+Language" target="_blank" rel="noopener">openEHR wiki</a>, and was used by the global openEHR community in that form.</p>
</div>
</div>
<div class="sect2">
<h3 id="_tooling_status"><a class="anchor" href="#_tooling_status"></a>1.5. Tooling status</h3>
<div class="sect3">
<h4 id="_aql_features_not_yet_supported"><a class="anchor" href="#_aql_features_not_yet_supported"></a>1.5.1. AQL features not yet supported</h4>
<div class="paragraph">
<p>The following features are likely to be needed, but are not yet implemented in tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TOP</code></p>
</li>
<li>
<p><code>XOR</code>. Currently <code>AND</code>, <code>OR</code>, <code>NOT</code>, <code>EXISTS</code> are supported in <code>WHERE</code> clause.</p>
</li>
<li>
<p>functions are not supported.</p>
</li>
<li>
<p>embedded query is not supported</p>
</li>
<li>
<p><code>ORDER BY</code></p>
</li>
<li>
<p><code>TIMEWINDOW</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_aql_features_that_are_proposed_but_not_finalised"><a class="anchor" href="#_aql_features_that_are_proposed_but_not_finalised"></a>1.5.2. AQL features that are proposed, but not finalised</h4>
<div class="sect4">
<h5 id="_arithmetic_functions"><a class="anchor" href="#_arithmetic_functions"></a>1.5.2.1. Arithmetic functions</h5>
<div class="paragraph">
<p>It has been proposed that AQL would support some basic arithmetic functions, such as addition (plus) , subtraction (minus) . Multiplication, and division may be supported as well. We do not have any scenario requiring for these two functions yet.</p>
</div>
<div class="paragraph">
<p>Most cases, it is required that the left operand and the right operand must be the same type in order to do the calculation, e.g. numeric types. openEHR RM supports addition and subtraction for the types of: <code>DV_QUANTITY</code>, <code>DV_COUNT</code>, <code>DV_INTERVAL</code>, <code>DV_PROPORTION</code>, <code>DV_DATE_TIME</code>, <code>DV_DATE</code>, and <code>DV_TIME</code>. Again, it is required that the left and right operands must be the same type. However, one exception to this is that openEHR RM also supports subtraction between all subtypes of <code>DV_TEMPORAL</code> and type of <code>DV_DURATION</code>. AQL would support these arithmetic functions that openEHR RM supports.</p>
</div>
<div class="paragraph">
<p>The example below shows a scenario which requires that a Composition report (c1) is issued in the last year. It illustrates that a type of ISO 8601 date string (<code>current-date()</code>) subtracts a type of ISO 8601 interval string (<code>P1Y</code>).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>c1/context/other_context/items[at0006]/items[at0013]/value &gt; current-date() - P1Y</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_other_functions"><a class="anchor" href="#_other_functions"></a>1.5.2.2. Other functions</h5>
<div class="paragraph">
<p>It is proposed that AQL may also support other functions, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>current-date()</code>: a build-in function returning the current date value in ISO date string format.</p>
</li>
<li>
<p><code>current-date-time()</code>: a build-in function returning the current date time value in ISO date/time string format.</p>
</li>
<li>
<p><code>max</code>: a build-in function returning the max value out of an expression.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_further_discussions"><a class="anchor" href="#_further_discussions"></a>1.6. Further discussions</h3>
<div class="paragraph">
<p>The existing AQL grammar and syntax could be further enhanced in the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reduce the length of the query statement. The use of archetype path in AQL query makes the query lengthy and hard to read. Local variables with meaningful names that are assigned with path can be used to reduce the length of the query as well as improve readability of the query. One example is shown below:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>let $systolic_bp="data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude"
let $diastolic_bp="data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude"

SELECT
    obs/$systolic_bp, obs/$diastolic_bp
FROM
    EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
        CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
    obs/$systolic_bp&gt;= 140 OR obs/$diastolic_bp&gt;=90</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_existing_query_languages"><a class="anchor" href="#_existing_query_languages"></a>2.1. Existing Query Languages</h3>
<div class="paragraph">
<p>Currently, the available query languages, such as SQL, XQuery, or Object-Oriented Query Language, have dependencies on particular system data structure and working environment. Users must know the persistence data structure of an EHR in order to write an appropriate query. The query statement cannot be used by other systems which have different data store. Consequently, none of the these languages meet the aforementioned requirements and none of these can be used directly as the query language required by integrated care EHRs</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_is_aql"><a class="anchor" href="#_what_is_aql"></a>2.2. What is AQL?</h3>
<div class="paragraph">
<p>Archetype Query Language (AQL) is a declarative query language developed specifically for expressing queries used for searching and retrieving the clinical data found in archetype-based EHRs. It is applied to the openEHR EHR Reference Model (RM) and the openEHR clinical archetypes, but the syntax is independent of applications, programming languages, system environment, and storage models. The minimum requirement for data to be querying with AQL (including with archetype structures and terminology) is for the data to be marked at a fine granularity with the appropriate archetype codes and terminology codes. This may be native openEHR-structured data, or legacy system data to which the relevant data markers (mainly archetype paths and terminology codes) have been added. Unlike other query languages, such as SQL or XQuery, AQL expresses the queries at the archetype level, i.e. semantic level, other than at the data instance level. This is the key in achieving sharing queries across system boundaries or enterprise boundaries.</p>
</div>
<div class="paragraph">
<p>AQL has the following distinctive features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>the utilization of openEHR archetype path syntax in AQL. openEHR path syntax is used to locate clinical statements and data values within them using Archetypes. This path syntax is used to represent the query criteria and returned results. It allows setting query criteria using archetype and node identifiers, data values within the archetypes, and class attributes defined within the openEHR RM. It also allows the returned results to be top-level archetyped RM objects, data items within the archetypes or RM attribute values.</p>
</li>
<li>
<p>the utilization of containment mechanisms to indicate the data hierarchy and constrain the source data to which the query is applied.</p>
</li>
<li>
<p>the utilization of ADL-like operator syntaxes, such as matches, exists, in, negation.</p>
</li>
<li>
<p>Neutral expression syntax. AQL does not have any dependencies on the underlying RM of the archetypes. It is neutral to system implementation and environment.</p>
</li>
<li>
<p>Supporting queries with logical time-based data rollback.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>AQL has some other features which can be found from other query languages:
. Supporting naming returned results.
. Supporting query criteria parameters.
. Supporting arithmetic operations (such as count, addition, subtraction, multiplication, and division), relational operations (<code>&gt;</code>, <code>&gt;=</code>, <code>=</code>, <code>!=</code>, <code>&lt;=</code>, <code>&lt;</code>) and Boolean operations (<code>OR</code>, <code>AND</code>, <code>XOR</code>, <code>NOT</code>).
. Supporting some functions that are supported in XQuery, such as <code>current-date()</code>.
. Users can specify their preference on the retrieved data, such as ordering preferences, or total number of retrieved results.
. Supporting queries for individual clinical subjects at the point of care, administrative purposes and clinical research purposes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_structure_example"><a class="anchor" href="#_structure_example"></a>2.3. Structure &amp; Example</h3>
<div class="paragraph">
<p>Like SQL, AQL has five clauses: <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code>, <code>ORDER BY</code>, and <code>TIMEWINDOW</code>. The <code>SELECT</code> clause specifies the data elements to be returned. The <code>FROM</code> clause specifies the result source and the corresponding containment criteria. The WHERE clause specifies data value criteria within the result source. The <code>ORDER BY</code> clause indicates the data items used to order the returned result set. <code>TIMEWINDOW</code> clause is to constrain the query to data that was available in the system within the specified time criteria.</p>
</div>
<div class="paragraph">
<p>Below is an example of AQL statement. This statement returns all blood pressure values where systolic value is greater or equal to 140 or whose diastolic value is greater or equal to 90 within a specified EHR. AQL syntax is a synthesis of SQL structural syntax and openEHR path syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT                                                          -- Select clause
    o/data[at0001]/.../items[at0004]/value AS systolic,         -- Identified path with named result
    o/data[at0001]/.../items[at0005]/value AS systolic,
FROM                                                            -- From clause
    EHR[ehr_id=$ehrId]                                          -- RM class expression
        CONTAINS                                                -- containment
            COMPOSITION c                                       -- RM class expression
                [openEHR-EHR-COMPOSITION.encounter.v1]          -- archetype predicate
        CONTAINS
            OBSERVATION o
                [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE                                                           -- Where clause
    o/data[at0001]/.../items[at0004]/value/value &gt;= 140 OR      -- value comparison
    o/data[at0001]/.../items[at0005]/value/value &gt;= 90</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aql_syntax_description"><a class="anchor" href="#_aql_syntax_description"></a>3. AQL Syntax Description</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_overview_2"><a class="anchor" href="#_overview_2"></a>3.1. Overview</h3>
<div class="paragraph">
<p>AQL has <code>SELECT</code>, <code>FROM</code>, <code>WHERE</code> and <code>ORDER BY</code>  clauses. openEHR path syntax is used to locate any node or data values within archetypes. The <code>SELECT</code> clause uses openEHR path syntax to indicate expected archetypes, elements, or data values that are need to be returned. The <code>FROM</code> clause uses containment mechanisms indicating the scope of the query data source. <code>WHERE</code> clause utilises archetype path to set query criteria on archetypes or any node within the archetypes. The following sections introduce the AQL syntax in detail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reserved_words_and_characters"><a class="anchor" href="#_reserved_words_and_characters"></a>3.2. Reserved words and characters</h3>
<div class="paragraph">
<p>AQL has the following reserved keywords and characters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SELECT, FROM, WHERE, ORDER BY, TOP, AND, OR</code></p>
</li>
<li>
<p><code>CONTAINS, max, now, current-date, current-date-time</code></p>
</li>
<li>
<p><code>TIMEWINDOW</code> (need to be confirmed)</p>
</li>
<li>
<p><code>matches</code>, <code>in</code>, <code>exists</code>, <code>not in</code></p>
</li>
<li>
<p><code>"</code> and <code>'</code>: double and single quote characters are used to delimit string values;</p>
</li>
<li>
<p><code>|</code>: bar characters are used to delimit intervals;</p>
</li>
<li>
<p><code>[]</code>: brackets are used to delimit coded terms, archetype id values or openEHR reference model class attribute values.</p>
</li>
<li>
<p><code>{}</code>: brackets are used with <code>matches</code> delimiting matches criteria</p>
</li>
<li>
<p><code>&lt;</code>, <code>&gt;</code>, <code>=</code>, <code>%</code>, <code>!</code>, <code>$</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_openehr_path_syntax"><a class="anchor" href="#_openehr_path_syntax"></a>3.3. openEHR path syntax</h3>
<div class="paragraph">
<p>The openEHR path syntax has been described in a detail (see the <a href="https://specifications.openehr.org/releases/BASE/latest/architecture_overview.html">Architecture Overview specification</a>). AQL utilises the basic openEHR path syntax to represent both coarse-grained and fine-grained archetype nodes and openEHR class instances and attributes. The syntax details are not repeated here. A set of openEHR path examples are provided.</p>
</div>
<div class="sect3">
<h4 id="_openehr_path_examples_archetype_path"><a class="anchor" href="#_openehr_path_examples_archetype_path"></a>3.3.1. openEHR path examples - archetype path</h4>
<div class="paragraph">
<p>An archetype path is the path referring to any node within an archetype. The following is an ADL workbench screen shot of apgar observation node map. The table below shows some examples.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Archetype RM type</th>
<th class="tableblock halign-left valign-top">Archetype node name</th>
<th class="tableblock halign-left valign-top">Path syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBSERVATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apgar score</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBSERVATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 minute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/data[at0002]/events[at0003]</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OBSERVATION</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Heart rate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/data[at0002]/events[at0003]/data[at0001]/items[at0005]</code> x</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_openehr_path_examples_path_to_rm_class_attributes"><a class="anchor" href="#_openehr_path_examples_path_to_rm_class_attributes"></a>3.3.2. openEHR path examples - path to RM class attributes</h4>
<div class="paragraph">
<p>Another type of openEHR path is the path pointing to an attribute of openEHR Reference Model classes. The examples shown below uses the attributes from the <code>COMPOSITION</code> class.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 66.6666%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">OpenEHR RM attribute name</th>
<th class="tableblock halign-left valign-top">Path syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPOSITION.category</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/category</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPOSITION.context.start_time</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/context/start_time</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>COMPOSITION.uid.value</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>/uid/value</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_aql_variables"><a class="anchor" href="#_aql_variables"></a>3.4. AQL variables</h3>
<div class="paragraph">
<p>AQL variables are used to refer a specific archetype or openEHR class defined within an AQL statement. It has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AQL variable names must be defined in an AQL <code>FROM</code> clause.</p>
</li>
<li>
<p>A variable name must be unique within an AQL statement.</p>
</li>
<li>
<p>Not all classes or archetypes defined within an AQL statement need a variable name. It is required only when other clauses within the AQL statement need to refer to the class or archetype defined in the <code>FROM</code> clause. For instance, the example doesn&#8217;t define a variable name for EHR class. It has a variable name <code>c</code> indicating the Composition archetype <code>openEHR-EHR-COMPOSITION.encounter.v1</code>, and varialbe name <code>o</code> referring to the Observation archetype <code>openEHR-EHR-OBSERVATION.blood_pressure.v1</code>. Variable name <code>o</code> is used by both <code>WHERE</code> clause and <code>SELECT</code> clause.</p>
</li>
<li>
<p>Variable names are used by other clauses within the AQL statement along with openEHR path to form a complete AQL path - Identified path. Refer back to Section 2.2. example, <code>o/data[at0001/events[at0006]/data[at0003]/items[at0004]/value/value]</code> points to the systolic value node of the Observation archetype <code>openEHR-EHR-OBSERVATION.blood_pressure.v1</code>.</p>
</li>
<li>
<p>Except for the reserved words, any characters, whitespace, letters, Alphanumeric, and underscore can be used for a variable name. Variable names are not case sensitive. Digits are not recommended at the beginning of a variable name even though there is no formal restriction.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_parameters"><a class="anchor" href="#_parameters"></a>3.5. Parameters</h3>
<div class="paragraph">
<p>AQL syntax supports parameterisation. AQL parameters are used to indicate criteria, which will be substituted with values at run time. Supporting parameterisation is one of the mechanisms used to realise sharing AQL statements within a system or across system boundaries.</p>
</div>
<div class="paragraph">
<p>The parameters can be EHR specific (such as the parameter of EHR identifier or EHR creation date time), archetype specific (such as an archetype identifier, or archetype constraints), or template specific (such as a template identifier or template constraints).</p>
</div>
<div class="sect3">
<h4 id="_when_parameters_are_needed"><a class="anchor" href="#_when_parameters_are_needed"></a>3.5.1. When parameters are needed</h4>
<div class="paragraph">
<p>Parameters are needed when the same AQL query statement is used with different criteria values. This AQL example is to return all abnormal blood pressure values for a single specific EHR. This query has a parameter <code>$ehrUid</code>. This parameter will be substituted by a specific <code>EHR.ehr_id</code> value at run time. Consequently, this query can be reused for all EHRs either within an EHR system or by other EHR systems (assuming these EHR systems support AQL).</p>
</div>
</div>
<div class="sect3">
<h4 id="_where_and_how_parameters_are_resolved"><a class="anchor" href="#_where_and_how_parameters_are_resolved"></a>3.5.2. Where and how parameters are resolved</h4>
<div class="paragraph">
<p>AQL query parameters can be resolved at application level, or EHR system level. It depends on what the query parameters are used for and the design/implementation of the system or components. Query parameters would be normally resolved outside of a query engine.</p>
</div>
<div class="paragraph">
<p>If a query needs to be reusable across different EHR systems, any query parameters normally need to be registered in these EHR systems so that they can be resolved with real values from each environment. A typical example of this type of query parameter is <code>$ehrUid</code>. If the query is only used within an application, then the query parameters would be resolved by the application, such as the parameter of healthcare facility identifier or template identifier.</p>
</div>
<div class="paragraph">
<p>There are no specific guidelines on how to resolve query parameters. Generally speaking, a parameter name is used as a key (or a key is associated with a parameter name) and the key needs to be unique within the boundary where the parameters are resolved. The EHR system or application needs to have the API functions to get the real value with a given parameter name or key.</p>
</div>
</div>
<div class="sect3">
<h4 id="_parameter_syntax"><a class="anchor" href="#_parameter_syntax"></a>3.5.3. Parameter syntax</h4>
<div class="paragraph">
<p>A parameter always starts with a dollar sign <code>$</code> followed by the parameter name, e.g. <code>$ehrUid</code>. The parameter name can consist of letters, digits and underscores. It cannot have spaces and it cannot be an AQL reserved word.</p>
</div>
<div class="paragraph">
<p>A parameter can be used for any criteria values within an AQL statement, e.g.:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>within a predicate: <code>[$archetypeId], [at0003, $nameValue], [ehr_id/value=$ehrId]</code></p>
</li>
<li>
<p>outside a predicate: <code>o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt; $systolicCriteria</code></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_predicates"><a class="anchor" href="#_predicates"></a>3.6. Predicates</h3>
<div class="paragraph">
<p>AQL has three types of predicates: the standard predicate, the archetype predicate, and the node predicate.</p>
</div>
<div class="sect3">
<h4 id="_standard_predicate"><a class="anchor" href="#_standard_predicate"></a>3.6.1. Standard predicate</h4>
<div class="paragraph">
<p>Standard predicates always have a left operand, operator and right operand, e.g. <code>[ehr_id/value='123456']</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The left operand is normally an openEHR path, such as <code>ehr_id/value</code>, <code>name/value</code>.</p>
</li>
<li>
<p>The right operand is normally a criterion value or a parameter, such as <code>'123456'</code>, <code>$ehrUid</code>. It can also be an openEHR path (based on the BNF).</p>
</li>
<li>
<p>The operator can be one of the following:</p>
<div class="listingblock">
<div class="content">
<pre>&gt;, &gt;=, =, &lt;, &lt;=, !=</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_archetype_predicate"><a class="anchor" href="#_archetype_predicate"></a>3.6.2. Archetype predicate</h4>
<div class="paragraph">
<p>An archetype predicate is a shortcut of a standard predicate, i.e. the predicate does not have the left operand and operator. It only has an archetype id, e.g. <code>[openEHR-EHR-COMPOSITION.encounter.v1]</code>. The archetype predicate is a specific type of query criterion indicating what archetype instances are relevant to this query. It is used to scope the the data source from which the query expected data is to be retrieved. Therefore, an archetype predicate is only used within an AQL <code>FROM</code> clause, for example,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM EHR [ehr_id/value='1234']
CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.encounter.v1]
CONTAINS OBSERVATION o [openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_node_predicate"><a class="anchor" href="#_node_predicate"></a>3.6.3. Node predicate</h4>
<div class="paragraph">
<p>A node predicate is also a shortcut of a standard predicate. It has the following forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Containing an <code>archetype_node_id</code> (i.e. an at-code) only, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002]</pre>
</div>
</div>
</li>
<li>
<p>Containing an <code>archetype_node_id</code> and a <code>name value/criterion</code>, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002 and name/value=$nameValue]
[at0002 and name/value='real name value']</pre>
</div>
</div>
</li>
<li>
<p>Containing an <code>archetype_node_id</code> and a shortcut of a <code>name/value</code> criterion, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002, $nameValue]
[at0002, 'real name value']</pre>
</div>
</div>
</li>
<li>
<p>The above three forms are the most common node predicates. A more advanced form is to include a general criterion instead of the <code>name/value</code> criterion within the predicate. The general criterion consists of left operand, operator, and right operand, e.g.:</p>
<div class="listingblock">
<div class="content">
<pre>[at0002 and value/defining_code/terminology_id/value=$terminologyId]</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>A node predicate defines criteria on fine-grained data. It is only used within an identified path.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_operators"><a class="anchor" href="#_operators"></a>3.7. Operators</h3>
<div class="sect3">
<h4 id="_basic_operators"><a class="anchor" href="#_basic_operators"></a>3.7.1. Basic operators</h4>
<div class="paragraph">
<p>The table below shows the basic AQL operators, meaning and example.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Operator</th>
<th class="tableblock halign-left valign-top">Meaning</th>
<th class="tableblock halign-left valign-top">Example</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>name/value = $nameValue</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;/data[at0003]/items[at0004]/value/value &gt;140</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Greater than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;./data[at0003]/items[at0004]/value/value &gt;=140</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smaller than</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;/data[at0003]/items[at0004]/value/value &lt;160</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smaller than or equal to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>o/data[at0001]/&#8230;&#8203;/data[at0003]/items[at0004]/value/value &#8656;160</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">!=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not equals to</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>c/archetype_details/template_id/value != ''</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_advanced_operators"><a class="anchor" href="#_advanced_operators"></a>3.7.2. Advanced operators</h4>
<div class="sect4">
<h5 id="_matches"><a class="anchor" href="#_matches"></a>3.7.2.1. matches</h5>
<div class="paragraph">
<p>The matches operator is used in the <code>WHERE</code> clause. This operator needs left operand and right operand. Left operand is an AQL identified path. Right operand is enclosed within curly braces. Right operand of matches operator has three forms:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>type of constraint ADL (cADL): this type of right operand can be a value list or a value range. Value range is not supported in the current AQL grammar. Below is an example with matches a string value list:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
    o/data[at0002]/events[at0003]/data/items[at0015]/items[at0018]/name
FROM
    Ehr [uid=$ehrUid]
        CONTAINS Composition c
            CONTAINS Observation o[openEHR-EHR-OBSERVATION.microbiology.v1]
WHERE
    o/data[at0002]/events[at0003]/data/items[at0015]/items[at0018]/items[at0019]/items[at0021]/name/defining_code/code_string matches {'18919-1', '18961-3', '19000-9'}</pre>
</div>
</div>
</li>
<li>
<p>URI: can be a terminology URI, openEHR EHR URI, or other URI. An example with a terminology URI is shown below:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
    e/ehr_status/subject/external_ref/id/value, diagnosis/data/items[at0002.1]/value
FROM
    EHR e
        CONTAINS Composition c[openEHR-EHR-COMPOSITION.problem_list.v1]
            CONTAINS Evaluation diagnosis[openEHR-EHR-EVALUATION.problem-diagnosis.v1]
WHERE
    c/name/value='Current Problems'
    AND diagnosis/data/items[at0002.1]/value/defining_code matches { terminology://Snomed-CT/hierarchy?rootConceptId=50043002 }</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_exists"><a class="anchor" href="#_exists"></a>3.7.2.2. EXISTS</h5>
<div class="paragraph">
<p><code>EXISTS</code> is a unary operator, which is always followed by a single operand. The single operand is an AQL identified path. This operator returns Boolean results: <code>true</code> means the data associated with the specified path exists, <code>false</code> otherwise. An <code>EXISTS</code> expression is a single identified expression. The latest grammar only allows this operator in <code>WHERE</code> clause. It may be required as part of openEHR path in future.</p>
</div>
<div class="paragraph">
<p>The example below means retrieving the identifiers of the EHRs which do not have discharge admin entry instance.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    e/ehr_id/value
FROM
    EHR e
        CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
            CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
    NOT EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1]</pre>
</div>
</div>
<div class="paragraph">
<p>This example below means from a particular EHR, retrieving all composition uid values and the contained instruction instances if the instruction instances have links with particular EHR URI value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    c/uid/value, instruction
FROM
    EHR e [ehr_id/value=$ehrid]
        CONTAINS COMPOSITION c
            CONTAINS INSTRUCTION instruction[openEHR-EHR-INSTRUCTION.referral.v1]
WHERE
    EXISTS instruction/links[target='ehr://327000002/87284370-2D4B-4e3d-A3F3-F303D2F4F34B@latest_trunk_version']</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_not"><a class="anchor" href="#_not"></a>3.7.2.3. NOT</h5>
<div class="paragraph">
<p><code>NOT</code> is a unary Boolean operator and it is always followed by either a single identified expression or boolean identified expression. It returns Boolean results: <code>true</code> means the followed expression (single or Boolean expression) is false.</p>
</div>
<div class="paragraph">
<p>The example below uses the <code>NOT</code> operator followed by a single identified expression</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    e/ehr_id/value
FROM
    EHR e
        CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
            CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
    NOT EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1]</pre>
</div>
</div>
<div class="paragraph">
<p>The example below uses <code>NOT</code> operator followed by a boolean identified expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    e/ehr_id/value
FROM
    EHR e
        CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
            CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
    NOT (EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1]
    AND e/ehr_status/subject/external_ref/namespace='CEC')</pre>
</div>
</div>
<div class="paragraph">
<p>The above example is equivallent to the two expressions shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    e/ehr_id/value
FROM
    EHR e
        CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
            CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
    NOT EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1]
    OR NOT e/ehr_status/subject/external_ref/namespace = 'CEC'


SELECT
    e/ehr_id/value
FROM
    EHR e
        CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.administrative_encounter.v1]
            CONTAINS ADMIN_ENTRY admission[openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
    NOT EXISTS c/content[openEHR-EHR-ADMIN_ENTRY.discharge.v1]
    OR e/ehr_status/subject/external_ref/namespace != 'CEC'</pre>
</div>
</div>
<div class="paragraph">
<p>These advanced operators are not yet supported by the grammar. The operator syntax is borrowed from ADL specifications. These are proposed to improve the richness and flexibility of AQL so that AQL syntax supports more complicated query scenarios.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_aql_identified_paths"><a class="anchor" href="#_aql_identified_paths"></a>3.8. AQL identified paths</h3>
<div class="sect3">
<h4 id="_usage"><a class="anchor" href="#_usage"></a>3.8.1. Usage</h4>
<div class="paragraph">
<p>Identified paths are used to locate data items within an archetype RM class. Except for the <code>FROM</code> clause, an identified path could appears in any clauses of an AQL statement. For example, it can be used to indicate the data to be returned in a <code>SELECT</code> clause, or the data item on which query criteria are applied in a <code>WHERE</code> clause.</p>
</div>
</div>
<div class="sect3">
<h4 id="_syntax"><a class="anchor" href="#_syntax"></a>3.8.2. Syntax</h4>
<div class="paragraph">
<p>AQL identified path can take any of the following forms:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an AQL variable name defined within the <code>FROM</code> clause, followed by an openEHR path, e.g.</p>
<div class="listingblock">
<div class="content">
<pre>o/data[at0001]/.../data[at0003]/items[at0004]/value/value</pre>
</div>
</div>
</li>
<li>
<p>an AQL variable name followed by a predicate, e.g.</p>
<div class="listingblock">
<div class="content">
<pre>o[name/value=$nameValue]</pre>
</div>
</div>
</li>
<li>
<p>an AQL variable name followed by a predicate and an openEHR path, e.g.</p>
<div class="listingblock">
<div class="content">
<pre>o[name/value=$nameValue]/data[at0001]/.../data[at0003]/items[at0004]/value/value</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_leaf_data"><a class="anchor" href="#_leaf_data"></a>3.9. Leaf Data</h3>
<div class="sect3">
<h4 id="_primitive_types"><a class="anchor" href="#_primitive_types"></a>3.9.1. Primitive Types</h4>
<div class="sect4">
<h5 id="_string_data"><a class="anchor" href="#_string_data"></a>3.9.1.1. String Data</h5>
<div class="paragraph">
<p>All strings are enclosed in double quotes or single quotes. Line breaks are not supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_integer_data"><a class="anchor" href="#_integer_data"></a>3.9.1.2. Integer data</h5>
<div class="paragraph">
<p>Integers are represented as numberic literals, such as <code>1</code>, <code>2</code>, <code>365</code>. Commas or periods for breaking long numbers are not allowed. Hex integers are not supported.</p>
</div>
</div>
<div class="sect4">
<h5 id="_real_data"><a class="anchor" href="#_real_data"></a>3.9.1.3. Real data</h5>
<div class="paragraph">
<p>Real numbers are the decimal literals that include a decimal point, such as <code>3.1415926</code>. Commas or periods for breaking long numbers are not allowed.</p>
</div>
</div>
<div class="sect4">
<h5 id="_boolean_data"><a class="anchor" href="#_boolean_data"></a>3.9.1.4. Boolean data</h5>
<div class="paragraph">
<p>Boolean values are indicated using the case-insensitive literals <code>true</code> or <code>false</code>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_dates_and_times"><a class="anchor" href="#_dates_and_times"></a>3.9.1.5. Dates and Times</h5>
<div class="paragraph">
<p>No matter whether the date/date time is complete or partial, it is allowed in AQL as long as it is in ISO8601 date/date time format. Quotes (either single quotes or double quotes) are required to enclose the date/date time value. In AQL grammar, it is treated as a date value if the value is a complete calendar date represented in ISO8601 extended format and if single quotes are used. If the value is in other ISO8601 date/date time format, AQL treats it as a string value, but the AQL query engine processes it differently from a normal string value. It is a temporary solution. In future, a date/date time value should be identified as date/date time value if it is a valid ISO8601 date/date time. Examples are as below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WHERE composition/context/start_time &gt; '19860101' // a complete date. AQL grammar identifies it as a string value.
WHERE composition/context/start_time &lt; "120000+0930"  // ISO8601 time. AQL grammar identifies it as a string value.
WHERE composition/context/start_time &lt;= '1986-01-01'  // complete calendar date in ISO8601 extended format. AQL grammar identifies this value as a date value.</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_other_built_in_types"><a class="anchor" href="#_other_built_in_types"></a>3.9.2. Other Built-in Types</h4>
<div class="sect4">
<h5 id="_uri"><a class="anchor" href="#_uri"></a>3.9.2.1. URI</h5>
<div class="paragraph">
<p>URI leaf data is enclosed within curly braces after <code>matches</code> operator. URI can be expressed as a normal URI described in <a href="http://www.ietf.org/rfc/rfc3986">IETF RFC 3986</a>. URIs are not case sensitive. In AQL, a URI can be either terminology URI or an EHR URI.</p>
</div>
</div>
<div class="sect4">
<h5 id="_terminology_uri"><a class="anchor" href="#_terminology_uri"></a>3.9.2.2. Terminology URI</h5>
<div class="paragraph">
<p>A terminology URI consists of the following components:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>terminology</strong>: the URI schemes value;</p>
</li>
<li>
<p><strong>terminology service</strong>: the URI authority value, such as SNOMED-CT;</p>
</li>
<li>
<p><strong>terminology function name</strong>: the URI path, e.g. "hierarchy" is the function name in the example shown below;</p>
</li>
<li>
<p><strong>argument values</strong> required by the terminology functions - URI queries;</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is an example of a terminology URI:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>    terminology://snomed-CT/hierarchy?rootConceptId=50043002
    \_________/   \_______/ \_______/ \___________/ \______/
        |             |         |           |__________|
     scheme       authority   path          | queries  |
        |             |         |           |          |
    terminology  terminology function    argument   argument
       uri         service                 name      value</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_value_list"><a class="anchor" href="#_value_list"></a>3.9.2.3. Value List</h5>
<div class="paragraph">
<p>Value list leaf data is enclosed within curly braces after matches operator. Each item is separated by comma if there are multiple items in the list. Value list can be string value list, date time value list, integer value list, and real value list. Quotes are required for string value list and date time value list.</p>
</div>
<div class="paragraph">
<p>A value list is only used in AQL` WHERE` clause when the criteria is to match one item of the list. The relationships among these value list items are "OR".</p>
</div>
<div class="paragraph">
<p>Some examples of value list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>matches {'string item 1', 'string item 2', 'string item3'}  // a string list. It Equivalent to
                                                            // matches  string item1' or ..
                                                            // matches 'string item 2' or ..
                                                            // matches 'string item 3'
matches {'20060101', '20070101', '20080101'}                // a date value list
matches {1, 2, 3}                                           // a integer list
matches {1.1, 2.5, 3.8}                                     // a real value list</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_value_range"><a class="anchor" href="#_value_range"></a>3.9.2.4. Value Range</h5>
<div class="paragraph">
<p>It is not supported in the current AQL grammar.</p>
</div>
<div class="paragraph">
<p>Value range leaf data is enclosed within curly braces after matches operator. It is only used in AQL <code>WHERE</code> clause to specify a criteria within a range. The syntax is similar to intervals of ordered primitive types detailed in Section 4.5.2, adl.pdf. Some examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>matches {|3.0..5.0|} // means 3.0 &lt;= x &lt;=5.0
matches {|&lt;8|}       // means x &lt; 8</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_query_structure"><a class="anchor" href="#_query_structure"></a>3.10. Query structure</h3>
<div class="sect3">
<h4 id="_overview_3"><a class="anchor" href="#_overview_3"></a>3.10.1. Overview</h4>
<div class="paragraph">
<p>AQL structure has been briefly introduced in Section 2.2. This section describes the syntax in more formal detail.</p>
</div>
<div class="paragraph">
<p>AQL structure has the following clauses and these clauses must be listed in the same order as the list below in an AQL statement. An AQL statement must contain <code>SELECT</code> and <code>FROM</code> clauses.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>SELECT</code> (mandatory)</p>
</li>
<li>
<p><code>FROM</code> (mandatory)</p>
</li>
<li>
<p><code>WHERE</code> (optional)</p>
</li>
<li>
<p><code>ORDER BY</code> (optional)</p>
</li>
<li>
<p><code>TIMEWINDOW</code> (optional)</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_from"><a class="anchor" href="#_from"></a>3.10.2. FROM</h4>
<div class="paragraph">
<p>The <code>FROM</code> clause utilises class expressions and a set of containment criteria to specify the data source from which the query required data is to be retrieved.  Its function is similar as the <code>FROM</code> clause of an SQL expression.</p>
</div>
<div class="sect4">
<h5 id="_from_syntax"><a class="anchor" href="#_from_syntax"></a>3.10.2.1. FROM Syntax</h5>
<div class="paragraph">
<p>A simple <code>FROM</code> clause consists of three parts: keyword <code>FROM</code>, class expression and/or containment constraints, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM
    EHR e [ehr_id/value=$ehrId]
        CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.report.v1]</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_class_expressions"><a class="anchor" href="#_class_expressions"></a>3.10.2.2. Class expressions</h5>
<div class="paragraph">
<p>Two examples of a class expression are shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>EHR e [ehr_id/value=$ehrId]                        \\EHR class, class identifier/variable, and a standard predicate
COMPOSITION c[openEHR-EHR-COMPOSITION.report.v1]   \\COMPOSITION class, class identifier/variable, and an archetype predicate</pre>
</div>
</div>
<div class="paragraph">
<p>Class expressions are used for two purposes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>indicating the constraints on RM classes so as to scope the data source for the query. For instance, <code>EHR e[ehr_id/value='123456']</code> indicates that the required data must be from a specific EHR with <code>ehr_id</code> value '123456'; while <code>COMPOSITION c[openEHR-EHR-COMPOSITION.report.v1]</code> indicates the required data must be from or must be associated with a Composition instance with archetype id - <code>openEHR-EHR-COMPOSITION.report.v1</code>.</p>
</li>
<li>
<p>defining a RM class variable that may be used by other clauses to indicate the required data or data items on which query criteria are applied. The example below uses the class expression to define a variable e which is used by the <code>SELECT</code> clause indicating all relevant ehr_id values are retrieved, and a variable c used by WHERE clause indicating that the query criteria is set on the composition template id value.</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
    e/ehr_id/value
FROM
    EHR e
        CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.referral.v1]
WHERE
    c/archetype_details/template_id/value=$templateId</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Class expressions syntax include three parts. A class expression must have part one and at least one of part two or part three.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>part one (mandatory): openEHR RM class name, such as <code>EHR</code>, <code>COMPOSITION</code>, <code>OBSERVATION</code> etc.</p>
</li>
<li>
<p>part two (optional): AQL variable name</p>
</li>
<li>
<p>part three (optional): a standard predicate or an archetype predicate.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_containment"><a class="anchor" href="#_containment"></a>3.10.2.3. Containment</h5>
<div class="paragraph">
<p>Since archetypes are in hierarchical structure, AQL has a containment constraint which specifies the hierarchical relationships between parent and child data items. The <code>FROM</code> clause utilises this hierarchical constraint along with class expression to determine the data source to which the AQL query is applied.</p>
</div>
<div class="paragraph">
<p>The syntax of containment constraint is very simple: using keyword <code>CONTAINS</code> between two class expressions. Left class expression is the the parent object of the right class expression, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>EHR e CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.referral.v1]</pre>
</div>
</div>
<div class="paragraph">
<p>Boolean operators (<code>AND</code>, <code>OR</code>, <code>NOT</code>) and parentheses are used when multiple containment constrains are required, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>EHR e
    CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.referral.v1] AND COMPOSITION c1 [openEHR-EHR-COMPOSITION.report.v1]

EHR e
    CONTAINS COMPOSITION c [openEHR-EHR-COMPOSITION.referral.v1]
        CONTAINS (OBSERVATION o [openEHR-EHR-OBSERVATION-laboratory-hba1c.v1] AND OBSERVATION o1 [openEHR-EHR-OBSERVATION-laboratory-glucose.v1])</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_where"><a class="anchor" href="#_where"></a>3.10.3. WHERE</h4>
<div class="paragraph">
<p>An AQL <code>WHERE</code> clause is used to represent further criteria applied to the data items within the objects declared in the FROM clause. A <code>WHERE</code> clause expresses the query criteria that cannot be represented in other AQL clauses, such as criteria on archetype id, composition committal date time, and the criteria on in which order the returned results should be listed.</p>
</div>
<div class="sect4">
<h5 id="_syntax_2"><a class="anchor" href="#_syntax_2"></a>3.10.3.1. Syntax</h5>
<div class="paragraph">
<p>The <code>WHERE</code> clause syntax has the following parts (in order): keyword <code>WHERE</code> and identified expression(s). Boolean operators (<code>AND</code>, <code>OR</code>, <code>NOT</code>) and parenthesis can be used to represent multiple identified expressions. Examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>WHERE
    c/name/value=$nameValue AND c/archetype_details/template_id/value=$templateId

WHERE
    (c/name/value=$nameValue OR c/archetype_details/template_id/value=$templateId)
    AND o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_identified_expression"><a class="anchor" href="#_identified_expression"></a>3.10.3.2. Identified expression</h5>
<div class="paragraph">
<p>Identified expression specifies the criteria within <code>WHERE</code> clause. It consists of left operand, operator and right operand.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Left operand is normally an identified path,</p>
</li>
<li>
<p>Operator is normally the basic operator,</p>
</li>
<li>
<p>Right operand is the criteria value, which normally is primitive type, such as String, Integer, Boolean, Double, or Float. When it is a string value, single quotation marks or double quotation marks are required. Right operand can also be a parameter or an identified path as well.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Examples:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Left operand is an identified path and right operand is a real criteria value - primitive type:</p>
<div class="listingblock">
<div class="content">
<pre>o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140
c/archetype_details/template_id/value='health_encounter'</pre>
</div>
</div>
</li>
<li>
<p>Left operand is an identified path and right operand is a parameter:</p>
<div class="listingblock">
<div class="content">
<pre>c/archetype_details/template_id/value=$templateParameter</pre>
</div>
</div>
</li>
<li>
<p>Both left operand and right operand are an identified path (this is an advanced feature):</p>
<div class="listingblock">
<div class="content">
<pre>o/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;
o1/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_select"><a class="anchor" href="#_select"></a>3.10.4. SELECT</h4>
<div class="paragraph">
<p>A <code>SELECT</code> clause specifies what data is to be retrieved by the AQL query. The data can be any types from openEHR RM and any primitive data types. In addition, the <code>SELECT</code> clause uses <code>TOP</code> to indicate the number of result setS that should be returned and name alias to rename the retrieved data.</p>
</div>
<div class="paragraph">
<p>The <code>SELECT</code> syntax always starts with keyword <code>SELECT</code>, followed by <code>TOP</code> (optional), and identified path(s) or variable name(s) defined in the <code>FROM</code> clause. Each variable name or an identified path may have a name alias renaming the associated data.</p>
</div>
<div class="paragraph">
<p>If variable name(s) is(are) required, the full object of the type associated with the variable is retrieved, such as a <code>COMPOSITION</code>, an <code>OBSERVATION</code> object etc. If identified paths are required, the path-associated data items are returned. Multiple identifiers or identified paths are separated using a comma.</p>
</div>
<div class="paragraph">
<p>Some examples are shown below.</p>
</div>
<div class="paragraph">
<p>Example 1: retrieve all compositions' name value, context start time and composer name from a specific EHR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    c/name/value AS Name, c/context/start_time AS date_time, c/composer/name AS Composer
FROM
    EHR e[ehr_id/value=$ehrUid] CONTAINS COMPOSITION c</pre>
</div>
</div>
<div class="paragraph">
<p>Example 2: Retrieve all composition objects of a specific EHR.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    c
FROM
    EHR e[ehr_id/value=$ehrUid] CONTAINS COMPOSITION c</pre>
</div>
</div>
<div class="sect4">
<h5 id="_top"><a class="anchor" href="#_top"></a>3.10.4.1. TOP</h5>
<div class="paragraph">
<p>The <code>TOP</code> syntax was borrowed from SQL language for representing the number of result sets that should be returned by the AQL query. It uses <code>BACKWARD</code> and <code>FORWARD</code> to indicate the direction where to start to get the number of results to be returned.</p>
</div>
<div class="paragraph">
<p>It starts with keyword TOP, followed by an integer number and/or the direction (i.e. <code>BACKWARD</code>, <code>FORWARD</code>), e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SELECT
    TOP 10 c/name/value AS Name, c/context/start_time AS date_time, c/composer/name AS Composer
FROM
    EHR e[ehr_id/value=$ehrUid]
        CONTAINS COMPOSITION c</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_name_alias"><a class="anchor" href="#_name_alias"></a>3.10.4.2. Name alias</h5>
<div class="paragraph">
<p>As in SQL, <code>AQL</code> supports the use of a name alias for the retrieved data. This is domne with the keyword <code>AS</code>, followed by the name which conforms to the syntax rule of AQL variable.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_order_by"><a class="anchor" href="#_order_by"></a>3.10.5. ORDER BY</h4>
<div class="paragraph">
<p>The <code>ORDER BY</code> clause is used to sort the returned results. The keyword <code>ORDER BY</code> is followed by an identified path and the keyword <code>DESC</code>, <code>DESCENDING</code>, <code>ASCE</code>, or <code>ASCENDING</code>, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ORDER BY c/name/value</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_timewindow"><a class="anchor" href="#_timewindow"></a>3.10.6. TIMEWINDOW</h4>
<div class="paragraph">
<p>In addition to the <code>FROM</code> clause, <code>TIMEWINDOW</code> helps to scope the data source from which the required data is retrieved. <code>TIMEWINDOW</code> is an addition query clause used in AQL to constrain the query to data that was available in the system (also know the data committal time) within the specified time criteria. This supports a timebased logical system rollback allowing a query to be executed as though it was performed at that specified time, which is essential for medico-legal reporting.</p>
</div>
<div class="paragraph">
<p>It starts with the keyword <code>TIMEWINDOW</code>, and followed by a string compatible with the ISO 8601 representation of time interval.</p>
</div>
<div class="paragraph">
<p>The first example below constrains the query source to data committed to the system before 2006-01-01.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TIMEWINDOW /2006-01-01</pre>
</div>
</div>
<div class="paragraph">
<p>The second example constrains the query source to data committed within the period of two years before 2006-01-01.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>TIMEWINDOW P2Y/2006-01-01</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_result_structure"><a class="anchor" href="#_result_structure"></a>4. Result structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The result structure of an AQL query is described as part of the <a href="https://openehr.atlassian.net/wiki/display/spec/Ocean+Informatics+EHR+Service+Interface">openEHR EHR service definition</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aql_operator_syntax_examples"><a class="anchor" href="#_aql_operator_syntax_examples"></a>5. AQL Operator Syntax Examples</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following sub-sections illustrate various AQL operators with examples.</p>
</div>
<div class="sect2">
<h3 id="_adl_matches_operator"><a class="anchor" href="#_adl_matches_operator"></a>5.1. ADL matches operator</h3>
<div class="paragraph">
<p>The following examples show how the ADL <code>matches</code> operator may be used within AQL statements.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
the ADL expressions on the right-hand side of the <code>matches</code> operator are in ADL 1.4 format.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 1</strong></th>
<th class="tableblock halign-left valign-top">Blood glucose &gt; 11 mmol/L or blood glucose &gt;= 200 mg/dL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data[at0001]/events[at0002 and name/value='Any event']/data[at0003]/items[at0013.1]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>ehr_path/value
    matches {
        C_DV_QUANTITY&lt;
            list = &lt;
               ["1"] = &lt;
                   units = &lt;"mmol/L"&gt;
                   magnitude = &lt;|&gt;=11|&gt;
               &gt;
               ["2"] = &lt;
                   units=&lt;"mg/dL"&gt;
                   magnitude=&lt;|&gt;=200|&gt;
               &gt;
            &gt;
        &gt;
    }</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 2</strong></th>
<th class="tableblock halign-left valign-top">Blood glucose level is between 5-6 mmol/L or between 90-110 mg/dL</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data[at0001]/events[at0002 and name/value='Any event']/data[at0003]/items[at0013.1]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>ehr_path/value
    matches {
        C_DV_QUANTITY&lt;
            list = &lt;
                ["1"] = &lt;
                    units = &lt;"mmol/L"&gt;
                    magnitude = &lt;|5.0..6.0|&gt;
                &gt;
                ["2"] = &lt;
                    units = &lt;"mg/dL"&gt;
                    magnitude = &lt;|90..110|&gt;
                &gt;
            &gt;
        &gt;
    }</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 3</strong></th>
<th class="tableblock halign-left valign-top">HbA1c &gt; 7.0%</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data[at0001]/events[at0002 and name/value='Any event']/data[at0003]/items[at0013.1]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>ehr_path/value matches {
    DV_PROPORTION matches {
        numerator matches {|&gt;7.0|}
        denominator matches {|100.0|}
    }
}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 4</strong></th>
<th class="tableblock halign-left valign-top">Total cholesterol &gt;= 5.0 mmol/L or LDL-C &gt;= 3.0 mmol/L</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total cholesterol EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data[at0001]/events[at0002 and name/value='Any event']/data[at0003]/items[at0013.1]</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>LDL-C EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data[at0001]/events[at0002 and name/value='Any event']/data[at0003]/items[at0011.1 and<br>
                                  name/value='Fractions']/items[at0013.4 and name/value='LDL-Cholesterol']</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>Total cholesterol EHR path/value matches {
    DV_QUANTITY matches {
        units matches {"mmol/L"}
        magnitude matches {|&gt;=5.0|}
    }
}

OR

LDL-C EHR path/value matches {
    DV_QUANTITY matches {
        units matches {"mmol/L"}
        magnitude matches {|&gt;=3.0|}
    }
}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 5</strong></th>
<th class="tableblock halign-left valign-top">Require all HbA1c values done in 1999</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Total cholesterol EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data/origin</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 1)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {"^1999"}</pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 2)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {|1999-??-??|</pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 3)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {|1999-01-01..1999-12-31|</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 6</strong></th>
<th class="tableblock halign-left valign-top">Require all blood glucose values done in the morning of 1st December, 1999</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data/origin</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 1)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {"^19991201T(((0[0-9])|10|11|)(([0-5][0-9])?([0-5][0-9])?)|(1200))$"}</pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 2)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {|1999-12-01T00:00:00..1999-12-01T11:59:59|}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 7</strong></th>
<th class="tableblock halign-left valign-top">Require all blood glucose values done in the morning of December, 1999</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data/origin</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 1)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {"^199912(([0-2][1-9])|10|20|30|31)?(T((0[0-5])|10|11)(([0-5][0-9])?([0-5][0-9])?))$"}</pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 2)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {|1999-12-ddT00:00:00..1999-12-ddT11:59:59|}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 8</strong></th>
<th class="tableblock halign-left valign-top">Require all HbA1c values done after 1999</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data/origin</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 1)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {"^[2-9]\d\d\d"}</pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 2)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {|&gt;1999-??-??|}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 9</strong></th>
<th class="tableblock halign-left valign-top">Require all HbA1c values done before 1999</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>EHR path</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p><code>o/data/origin</code></p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 1)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {"^1\d\d[0-8]"}</pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment<br>
(alt 2)</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>EHR path/value matches {|&lt;1999-??-??|}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 10</strong></th>
<th class="tableblock halign-left valign-top">Requires all reports composed by patient self</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>SELECT c
    FROM EHR e[ehr_id=$ehrUid] CONTAINS COMPOSITION c
    WHERE c/composer matches {PARTY_SELF}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_arithmetic_operators"><a class="anchor" href="#_arithmetic_operators"></a>5.2. Arithmetic operators</h3>
<div class="paragraph">
<p>The following example shows how arithmetic operators may be used within AQL statements.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 1</strong></th>
<th class="tableblock halign-left valign-top">For each recorded administration of ampicillin check for problem diagnosis of skin rash that is within 2 days of the administration date</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>SELECT e/ehr_id

FROM EHR e CONTAINS (COMPOSITION c1
       CONTAINS ACTION a [openEHR-EHR-ACTION.medication.v1]
           CONTAINS ITEM_TREE it [openEHR-EHR-ITEM_TREE.medication.v1]) AND
       CONTAINS (COMPOSITION c2 CONTAINS EVALUATION eval [openEHR-EHR-EVALUATION.problem-diagnosis.v1])

WHERE
    it/description[openEHR-EHR-ITEM_TREE.medication.v1]/items[at0001]/value matches {"SNOMED::31087008"} AND
    eval/data[at0001]/items[at0002.1]/value/value/defining_code matches {
          CODE_PHRASE matches {[SNOMED::294506009, 21626009]}
    } AND
    eval/data[at0001]/items[at0010]/value - it/description[openEHR-EHR-ITEM_TREE.medication.v1]/items[at0018]/items[at0019]/value
    matches {
      DV_DURATION matches {
          value matches{&lt;=P2d}
      }
    }</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_nest_query_and_not_in"><a class="anchor" href="#_nest_query_and_not_in"></a>5.3. Nest Query and 'Not in'</h3>
<div class="paragraph">
<p>The following example shows the use of a nested query and the <code>not-in</code> operator.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 1</strong></th>
<th class="tableblock halign-left valign-top">All patients who have not been discharged</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>SELECT e/ehr_id
FROM
    EHR e CONTAINS
        ADMIN_ENTRY ae1 [openEHR-EHR-ADMIN_ENTRY.admission.v1]
WHERE
    ae1/encounter_id/value not in (
        SELECT ae2/encounter_id/value
        FROM
            EHR e CONTAINS
                ADMIN_ENTRY ae2 [openEHR-EHR-ADMIN_ENTRY.discharge.v1]
    )</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_exists_operator"><a class="anchor" href="#_exists_operator"></a>5.4. Exists operator</h3>
<div class="paragraph">
<p>The following example shows how the <code>exists</code> operator may be used within AQL statements.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Clinical Scenario 1</strong></th>
<th class="tableblock halign-left valign-top">Require all blood pressure values with position recorded</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>AQL Fragment</strong></p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>SELECT o
FROM
    EHR e CONTAINS
        COMPOSITION CONTAINS
            OBSERVATION o [openEHR-EHR-OBSERVATION.blood_pressure.v1]
 WHERE
    exists {"o//*/state[at0007]/items[at0008]"}</pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_write_an_aql_query_statement_manually"><a class="anchor" href="#_how_to_write_an_aql_query_statement_manually"></a>6. How to write an AQL query statement manually</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section describes how to build an AQL query manually. The process described here gives may provide some hints for AQL builder tools.</p>
</div>
<div class="sect2">
<h3 id="_query_scenario"><a class="anchor" href="#_query_scenario"></a>6.1. Query scenario</h3>
<div class="paragraph">
<p>An example is used to illustrate how to write an AQL statement. The query scenario is:</p>
</div>
<div class="paragraph">
<p><strong>"Get all abnormal blood pressure values that are recorded in a health encounter for a specific patient."</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_step_1_the_from_clause"><a class="anchor" href="#_step_1_the_from_clause"></a>6.2. Step 1. The FROM clause</h3>
<div class="paragraph">
<p>A <code>FROM</code> clause is to scope the data source for the query. Normally the first step is to determine the <code>FROM</code> clause, which has EHR class expression and archetype class expressions.</p>
</div>
<div class="paragraph">
<p><strong>EHR class expression</strong></p>
</div>
<div class="paragraph">
<p>This determines whether this query is applied to a single EHR or all EHRs. The latter is called a population query. If it is for all EHRs, there is no need to specify <code>ehr_id/value</code> in the <code>FROM</code> clause. Otherwise, you need to either specify a specific value or use a query parameter for <code>ehr_id/value</code> in a <code>FROM</code> clause. For this particular scenario, it is for a single EHR. A parameter called <code>ehrUid</code> is used for the <code>ehr_id/value</code>, giving this AQL query statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM EHR [ehr_id/value=$ehrUid]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Archetype expressions</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>To write archetype expressions in the <code>FROM</code> clause, the archetypes required for the scenario must be determined, since archetypes are used to represent clinical concepts. The easy way to identify archetypes for a scenario is to identify clinical concepts mentioned in the scenario. Each clinical concept is generally associated with one archetype. Two clinical concepts are mentioned in the above scenario: 'blood pressure' and 'health encounter'. From these concepts the two archetypes used in query are identified: an Observation archetype <code>openEHR-EHR-OBSERVATION.blood_pressure.v1</code>, and a Composition archetype <code>openEHR-EHR-COMPOSITION.encounter.v1</code>.</p>
</li>
<li>
<p>Determine whether a variable name is needed for each archetype class expression or not. This is useful if the reference to the archetype class expression is required by other AQL clauses. Without using variable names for the archetype expressions, the two archetype expressions are:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
OBSERVATION [openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
<div class="paragraph">
<p><strong>Containment expression</strong>.</p>
</div>
<div class="paragraph">
<p>The openEHR RM is used to identify the hierarchical relationships among the found archetypes so as to define the containment expression. For example, a Composition archetype is the parent of an Observation archetype, so the AQL query looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>FROM EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
CONTAINS OBSERVATION [openEHR-EHR-OBSERVATION.blood_pressure.v1]</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_the_where_clause"><a class="anchor" href="#_step_2_the_where_clause"></a>6.3. Step 2. The WHERE clause</h3>
<div class="paragraph">
<p>The <code>WHERE</code> clause represents all query criteria that cannot be represented in the <code>FROM</code> clause. To write <code>WHERE</code> clause expression, the following is needed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Find the criteria. The criteria required by the scenario are abnormal blood pressure values. Different guidelines may have different definitions for abnormal blood pressure values. Here <code>abnormal blood pressure</code> is interpreted to mean mean 1) the 'systolic pressure' value is greater than or equal to 140; OR 2) the 'diastolic pressure' value is greater than or equal to 90.</p>
</li>
<li>
<p>Write an identified expression for criterion 1).</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Write the Identified path for the systolic data value. A class variable name is needed as the reference to the blood pressure class expression defined in the <code>FROM</code> clause, so a variable name <code>obs</code> is added into the <code>FROM</code> clause. A path to systolic data value is also required to form the identified path. Two tools can be used to get the path: the <a href="/downloads/ADLworkbench">openEHR ADL Workbench</a> or <a href="/downloads/modellingtools">Template Designer</a>. The path to the systolic data value is <code>/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value</code>.</p>
</li>
<li>
<p>Get appropriate operator: <code>&gt;=</code> is chosen for criterion 1.</p>
</li>
<li>
<p>Get the criteria value - 140. The query statement including the identified expression for criterion 1) is shown below:</p>
<div class="listingblock">
<div class="content">
<pre>FROM
    EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
        CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Write an identified expression for criterion 2). Following the previous instruction to write the identified expression for criterion 2) which is shown as:</p>
<div class="listingblock">
<div class="content">
<pre>obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/value &gt;= 90</pre>
</div>
</div>
</li>
<li>
<p>Find the appropriate boolean operator to join criterion 1) and 2) - OR. The query statement looks like:</p>
<div class="listingblock">
<div class="content">
<pre>FROM
    EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
        CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]
WHERE obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/value &gt;= 140 OR
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/value &gt;= 90</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_the_select_clause"><a class="anchor" href="#_step_3_the_select_clause"></a>6.4. Step 3. The SELECT clause</h3>
<div class="paragraph">
<p>Writing a <code>SELECT</code> clause depends on determining:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>What return data is required. The afore-mentioned scenario requires abnormal blood pressure values as return values, including both systolic pressure and diastolic pressure.</p>
</li>
<li>
<p>Write the appropriate identified path to the required item (variable name is required if the class object is required). Multiple identified path is separated using comma. For this particular scenario, two identified paths are found for systolic and diastolic data value by following Step 2. The completed query statement looks like:</p>
<div class="listingblock">
<div class="content">
<pre>SELECT
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude,
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude

FROM
    EHR [ehr_id/value=$ehrUid] CONTAINS COMPOSITION [openEHR-EHR-COMPOSITION.encounter.v1]
        CONTAINS OBSERVATION obs [openEHR-EHR-OBSERVATION.blood_pressure.v1]

WHERE
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0004]/value/magnitude&gt;= 140 OR
    obs/data[at0001]/events[at0006]/data[at0003]/items[at0005]/value/magnitude&gt;= 90</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aql_syntax_specification"><a class="anchor" href="#_aql_syntax_specification"></a>7. AQL Syntax Specification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The following Antlr grammar expresses the AQL syntax.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="antlr-java"><span class="tok-c">// Author: Bostjan Lah</span><span class="tok-w"></span>
<span class="tok-c">// (c) Copyright, Marand, http://www.marand.com</span><span class="tok-w"></span>
<span class="tok-c">// Licensed under LGPL: http://www.gnu.org/copyleft/lesser.html</span><span class="tok-w"></span>
<span class="tok-c">// Based on AQL grammar by Ocean Informatics: http://www.openehr.org/wiki/download/attachments/2949295/EQL_v0.6.grm?version=1&amp;modificationDate=1259650833000</span><span class="tok-w"></span>
<span class="tok-k">grammar</span><span class="tok-w"> </span><span class="tok-nc">Aql</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">options</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">output</span><span class="tok-p">=</span>AST<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">ASTLabelType</span><span class="tok-p">=</span>CommonTree<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">backtrack</span><span class="tok-p">=</span>true<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nv">memoize</span><span class="tok-p">=</span>true<span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-k">tokens</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nl">ORDERDESC</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-nl">ORDERASC</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-nl">@header</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-kn">package</span> <span class="tok-nn">com.marand.thinkehr.aql.antlr</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">com.marand.thinkehr.aql.AqlRecognitionException</span><span class="tok-o">;</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-nl">@lexer</span><span class="tok-p">::</span><span class="tok-nl">header</span><span class="tok-p">{</span>
<span class="tok-kn">package</span> <span class="tok-nn">com.marand.thinkehr.aql.antlr</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">com.marand.thinkehr.aql.AqlRecognitionException</span><span class="tok-o">;</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-nl">@members</span><span class="tok-p">{</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">displayRecognitionError</span><span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">tokenNames</span><span class="tok-o">,</span> <span class="tok-n">RecognitionException</span> <span class="tok-n">e</span><span class="tok-o">)</span>
<span class="tok-p">{</span>
  <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">AqlRecognitionException</span><span class="tok-o">(</span><span class="tok-n">e</span><span class="tok-o">);</span>
<span class="tok-p">}</span>
<span class="tok-p">}</span><span class="tok-w"></span>

<span class="tok-c">// Rule Definitions</span><span class="tok-w"></span>
<span class="tok-c">//&lt;Query&gt; ::= &lt;Select&gt; &lt;From&gt;</span><span class="tok-w"></span>
<span class="tok-c">//           | &lt;Select&gt; &lt;From&gt; &lt;Where&gt;</span><span class="tok-w"></span>
<span class="tok-c">//            | &lt;Select&gt; &lt;From&gt; &lt;OrderBy&gt;   ! is this allowed?</span><span class="tok-w"></span>
<span class="tok-c">//            | &lt;Select&gt; &lt;From&gt; &lt;Where&gt; &lt;OrderBy&gt;</span><span class="tok-w"></span>
<span class="tok-nl">query</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">select</span><span class="tok-w"> </span><span class="tok-nv">from</span><span class="tok-w"> </span><span class="tok-nv">where</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">orderBy</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-s">&#39;;&#39;</span><span class="tok-o">!?</span><span class="tok-w"> </span><span class="tok-no">EOF</span><span class="tok-o">!</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;Select&gt; ::= &#39;SELECT&#39; &lt;SelectExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//         | &#39;SELECT&#39; &lt;TOP&gt; &lt;SelectExpr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">select</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">SELECT</span><span class="tok-w"> </span><span class="tok-nv">top</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">selectExpr</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">SELECT</span><span class="tok-w"> </span><span class="tok-nv">top</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">selectExpr</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;Top&gt; ::= &#39;TOP&#39; Integer</span><span class="tok-w"></span>
<span class="tok-c">//          | &#39;TOP&#39; Integer &#39;BACKWARD&#39;</span><span class="tok-w"></span>
<span class="tok-c">//          | &#39;TOP&#39; Integer &#39;FORWARD&#39;</span><span class="tok-w"></span>
<span class="tok-nl">top</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-no">FORWARD</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w">	</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-no">BACKWARD</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">TOP</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-no">BACKWARD</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;Where&gt; ::= &#39;WHERE&#39; &lt;IdentifiedExpr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">where</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">WHERE</span><span class="tok-w"> </span><span class="tok-nv">identifiedExpr</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">WHERE</span><span class="tok-w"> </span><span class="tok-nv">identifiedExpr</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;OrderBy&gt; ::= &#39;ORDER BY&#39; &lt;OrderBySeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">orderBy</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ORDERBY</span><span class="tok-w"> </span><span class="tok-nv">orderBySeq</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">ORDERBY</span><span class="tok-w"> </span><span class="tok-nv">orderBySeq</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;OrderBySeq&gt;  ::= &lt;OrderByExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;OrderByExpr&gt; &#39;,&#39; &lt;OrderBySeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">orderBySeq</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">orderByExpr</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;,&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">orderByExpr</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;OrderByExpr&gt; ::= &lt;IdentifiedPath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;DESCENDING&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;ASCENDING&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;DESC&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;IdentifiedPath&gt; &#39;ASC&#39;</span><span class="tok-w"></span>
<span class="tok-nl">orderByExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">identifiedPath</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">DESCENDING</span><span class="tok-o">|</span><span class="tok-no">DESC</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">ORDERDESC</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w">	</span><span class="tok-nv">identifiedPath</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">ASCENDING</span><span class="tok-o">|</span><span class="tok-no">ASC</span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">ORDERASC</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;SelectExpr&gt; ::= &lt;IdentifiedPathSeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">selectExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">identifiedPathSeq</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! When multiple paths provided, each IdentifiedPath must represent an object of type DataValue</span><span class="tok-w"></span>
<span class="tok-c">//&lt;IdentifiedPathSeq&gt; ::= &lt;IdentifiedPath//&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			| &lt;IdentifiedPath&gt; &#39;as&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-c">//			| &lt;IdentifiedPath&gt; &#39;,&#39; &lt;IdentifiedPathSeq&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			| &lt;IdentifiedPath&gt; &#39;as&#39; Identifier &#39;,&#39; &lt;IdentifiedPathSeq&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedPathSeq</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">selectVar</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;,&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">selectVar</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">selectVar</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">identifiedPath</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">asIdentifier</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">asIdentifier</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">AS</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;From&gt; ::=   &#39;FROM&#39; &lt;FromExpr&gt;		! stop or/and without root class</span><span class="tok-w"></span>
<span class="tok-c">//	    | &#39;FROM&#39; &lt;FromEHR&gt; &lt;ContainsExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//           | &#39;FROM&#39; &lt;FromEHR&gt;</span><span class="tok-w"></span>
<span class="tok-c">//!          &#39;FROM&#39; &lt;ContainsOr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">from</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">fromExpr</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">fromExpr</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">ehrContains</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">FROM</span><span class="tok-w"> </span><span class="tok-nv">ehrContains</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;FromEHR&gt; ::= &#39;EHR&#39; &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//              | &#39;EHR&#39; Identifier &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//              | &#39;EHR&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-nl">fromEHR</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EHR</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">ehrContains</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">fromEHR</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">CONTAINS</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">contains</span><span class="tok-o">)?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedExpr&gt; ::= &lt;IdentifiedEquality&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                   | &lt;IdentifiedExprBoolean&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                   |&#39;(&#39; &lt;IdentifiedExprBoolean&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//identifiedExpr</span><span class="tok-w"></span>
<span class="tok-c">//	: identifiedExprBoolean;</span><span class="tok-w"></span>
<span class="tok-c">//        | &#39;(&#39;! identifiedExprBoolean &#39;)&#39;!;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedExprBoolean&gt; ::= &lt;IdentifiedExpr&gt; &#39;OR&#39; &lt;IdentifiedExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &lt;IdentifiedExpr&gt; &#39;AND&#39; &lt;IdentifiedExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &lt;IdentifiedExpr&gt; &#39;XOR&#39; &lt;IdentifiedExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &#39;NOT&#39;&#39;(&#39; &lt;IdentifiedExprBoolean&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &#39;NOT&#39; &lt;IdentifiedEquality&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">identifiedExprAnd</span><span class="tok-w"> </span><span class="tok-o">((</span><span class="tok-no">OR</span><span class="tok-o">|</span><span class="tok-no">XOR</span><span class="tok-o">)^</span><span class="tok-w"> </span><span class="tok-nv">identifiedExprAnd</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">identifiedExprAnd</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">identifiedEquality</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">AND</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">identifiedEquality</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;IdentifiedEquality&gt; ::= &lt;IdentifiedOperand&gt; ComparableOperator &lt;IdentifiedOperand&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			     | &lt;IdentifiedOperand&gt; &#39;matches&#39; &#39;{&#39; &lt;MatchesOperand&gt; &#39;}&#39;</span><span class="tok-w"></span>
<span class="tok-c">//                          | &lt;IdentifiedOperand&gt; &#39;matches&#39; RegExPattern</span><span class="tok-w"></span>
<span class="tok-c">//                          | &#39;EXISTS&#39; &lt;IdentifiedPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedEquality</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">identifiedOperand</span><span class="tok-w"> </span><span class="tok-o">((</span><span class="tok-no">MATCHES</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-s">&#39;{&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">matchesOperand</span><span class="tok-w"> </span><span class="tok-s">&#39;}&#39;</span><span class="tok-o">!)|(</span><span class="tok-no">COMPARABLEOPERATOR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">identifiedOperand</span><span class="tok-o">))</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">EXISTS</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">EXISTS</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">identifiedExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-o">!</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">NOT</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">identifiedEquality</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">// 	| identifiedOperand &#39;matches&#39; &#39;{&#39; matchesOperand &#39;}&#39;</span><span class="tok-w"></span>
<span class="tok-c">//        | identifiedOperand &#39;matches&#39; REGEXPATTERN</span><span class="tok-w"></span>
<span class="tok-c">//        | &#39;EXISTS&#39; identifiedPath;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedOperand&gt; ::= &lt;Operand&gt; | &lt;IdentifiedPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedOperand</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">identifiedPath</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">//!&lt;IdentifiedOperand&gt; ::= &lt;Operand&gt; | &lt;RelativePath&gt;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;IdentifiedPath&gt;::= Identifier</span><span class="tok-w"></span>
<span class="tok-c">//                    | Identifier &lt;Predicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                    | Identifier &#39;/&#39; &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                    | Identifier &lt;Predicate&gt; &#39;/&#39; &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">identifiedPath</span><span class="tok-w"></span>
<span class="tok-w">	 </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">predicate</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;/&#39;</span><span class="tok-w"> </span><span class="tok-nv">objectPath</span><span class="tok-o">)?</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">predicate</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">objectPath</span><span class="tok-o">?)</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">//!		| Identifer &lt;AbsolutePath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//!		| Identifer &lt;Predicate&gt; &lt;AbsolutePath&gt;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;Predicate&gt; ::= &lt;NodePredicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">nodePredicate</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicate&gt; ::= &#39;[&#39;&lt;NodePredicateOr&gt;&#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">OPENBRACKET</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateOr</span><span class="tok-w"> </span><span class="tok-no">CLOSEBRACKET</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicateOr&gt; ::= &lt;NodePredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;NodePredicateOr&gt; &#39;or&#39; &lt;NodePredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicateOr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateAnd</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">OR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateAnd</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicateAnd&gt; ::= &lt;NodePredicateComparable&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;NodePredicateAnd&gt; &#39;and&#39; &lt;NodePredicateComparable&gt;</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicateAnd</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateComparable</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">AND</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">nodePredicateComparable</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicateComparable&gt; ::= &lt;PredicateOperand&gt; ComparableOperator &lt;PredicateOperand&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                          | NodeId</span><span class="tok-w"></span>
<span class="tok-c">//                          | NodeId &#39;,&#39; String        ! &lt;NodeId&gt; and name/value = &lt;String&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-c">//                          | NodeId &#39;,&#39; parameter     ! &lt;NodeId&gt; and name/value = &lt;Parameter&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-c">//                          | &lt;NodePredicateRegEx&gt;     ! /items[{/at0001.*/}], /items[at0001 and name/value matches {//}]</span><span class="tok-w"></span>
<span class="tok-c">//                          | ArchetypeId</span><span class="tok-w"></span>
<span class="tok-c">//                          | ArchetypeId &#39;,&#39; String        ! &lt;NodeId&gt; and name/value = &lt;String&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-c">//                          | ArchetypeId &#39;,&#39; parameter     ! &lt;NodeId&gt; and name/value = &lt;Parameter&gt; shortcut</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicateComparable</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">NODEID</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">COMMA</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">STRING</span><span class="tok-o">|</span><span class="tok-no">PARAMETER</span><span class="tok-o">))?</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">ARCHETYPEID</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">COMMA</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">STRING</span><span class="tok-o">|</span><span class="tok-no">PARAMETER</span><span class="tok-o">))?</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-w"> </span><span class="tok-o">((</span><span class="tok-no">COMPARABLEOPERATOR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-o">)|(</span><span class="tok-no">MATCHES</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">REGEXPATTERN</span><span class="tok-o">))</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">REGEXPATTERN</span><span class="tok-w">     </span><span class="tok-c">//! /items[{/at0001.*/}], /items[at0001 and name/value matches {//}]</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;NodePredicateRegEx&gt;    ::= RegExPattern</span><span class="tok-w"></span>
<span class="tok-c">//                          | &lt;PredicateOperand&gt; &#39;matches&#39; RegExPattern</span><span class="tok-w"></span>
<span class="tok-nl">nodePredicateRegEx</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">REGEXPATTERN</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-w"> </span><span class="tok-no">MATCHES</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">REGEXPATTERN</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;MatchesOperand&gt; ::= &lt;ValueListItems&gt;</span><span class="tok-w"></span>
<span class="tok-c">//			| UriValue</span><span class="tok-w"></span>
<span class="tok-nl">matchesOperand</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">valueListItems</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">URIVALUE</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! &lt;ValueList&gt; ::= &#39;{&#39;&lt;ValueListItems&gt;&#39;}&#39;</span><span class="tok-w"></span>
<span class="tok-c">//&lt;ValueListItems&gt; ::= &lt;Operand&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                     |&lt;Operand&gt; &#39;,&#39; &lt;ValueListItems&gt;</span><span class="tok-w"></span>
<span class="tok-nl">valueListItems</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;,&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;URI&gt;     ::= &#39;{&#39; UriValue &#39;}&#39;</span><span class="tok-w"></span>
<span class="tok-nl">uri</span><span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;{&#39;</span><span class="tok-w"> </span><span class="tok-no">URIVALUE</span><span class="tok-w"> </span><span class="tok-s">&#39;}&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;ArchetypePredicate&gt; ::= &#39;[&#39; ArchetypeId &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-c">//			 | &#39;[&#39; Parameter &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-c">//                      | &#39;[&#39; RegExPattern &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">archetypePredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">OPENBRACKET</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-nv">archetypeId</span><span class="tok-o">|</span><span class="tok-no">PARAMETER</span><span class="tok-o">|</span><span class="tok-no">REGEXPATTERN</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-no">CLOSEBRACKET</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">archetypeId</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ARCHETYPEID</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;VersionPredicate&gt; ::= &#39;[&#39; &lt;VersionPredicateOptions&gt; &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">versionPredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">OPENBRACKET</span><span class="tok-w"> </span><span class="tok-nv">versionPredicateOptions</span><span class="tok-w"> </span><span class="tok-no">CLOSEBRACKET</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;VersionPredicateOptions&gt; ::= &#39;latest_version&#39; | &#39;all_versions&#39;</span><span class="tok-w"></span>
<span class="tok-nl">versionPredicateOptions</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;latest_version&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">ALL_VERSIONS</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;StandardPredicate&gt; ::= &#39;[&#39; &lt;PredicateExpr&gt; &#39;]&#39;</span><span class="tok-w"></span>
<span class="tok-nl">standardPredicate</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;[&#39;</span><span class="tok-o">!</span><span class="tok-w"> </span><span class="tok-nv">predicateExpr</span><span class="tok-w"> </span><span class="tok-s">&#39;]&#39;</span><span class="tok-o">!</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateExpr&gt; ::= &lt;PredicateOr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateOr</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateOr&gt; ::= &lt;PredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;PredicateOr&gt; &#39;or&#39; &lt;PredicateAnd&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateOr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateAnd</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">OR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateAnd</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">// 	: (predicateOr &#39;or&#39;)? predicateAnd; !!!</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateAnd&gt; ::= &lt;PredicateEquality&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                 | &lt;PredicateAnd&gt; &#39;and&#39; &lt;PredicateEquality&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateAnd</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateEquality</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">AND</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateEquality</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">// 	: (predicateAnd &#39;and&#39;)? predicateEquality; !!!</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateEquality&gt; ::= &lt;PredicateOperand&gt; ComparableOperator &lt;PredicateOperand&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateEquality</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-w"> </span><span class="tok-no">COMPARABLEOPERATOR</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">predicateOperand</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;PredicateOperand&gt; ::= !Identifier</span><span class="tok-w"></span>
<span class="tok-c">//			!| Identifier PathItem</span><span class="tok-w"></span>
<span class="tok-c">//                     | &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                     | &lt;Operand&gt;</span><span class="tok-w"></span>
<span class="tok-nl">predicateOperand</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">objectPath</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">operand</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;Operand&gt; ::= String | Integer | Float | Date | Parameter | Boolean</span><span class="tok-w"></span>
<span class="tok-nl">operand</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">STRING</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">INTEGER</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">FLOAT</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">DATE</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">PARAMETER</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">BOOLEAN</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;ObjectPath&gt; ::=  &lt;PathPart&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                | &lt;PathPart&gt; &#39;/&#39; &lt;ObjectPath&gt;</span><span class="tok-w"></span>
<span class="tok-nl">objectPath</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">pathPart</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;/&#39;</span><span class="tok-w"> </span><span class="tok-nv">pathPart</span><span class="tok-o">)*</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">//&lt;PathPart&gt; ::= Identifier</span><span class="tok-w"></span>
<span class="tok-c">//           | Identifier &lt;Predicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">pathPart</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-nv">predicate</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;FromExpr&gt; ::=  &lt;SimpleClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		| &lt;SimpleClassExpr&gt; &lt;ContainsExpr&gt;</span><span class="tok-w"></span>
<span class="tok-nl">fromExpr</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">contains</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-nv">simpleClassExpr</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">CONTAINS</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-o">)?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! Check thislass</span><span class="tok-w"></span>
<span class="tok-c">//&lt;ContainsExpr&gt;::= &#39;CONTAINS&#39; &lt;ContainsExpression&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                  !&#39;CONTAINS&#39; &lt;ContainsOr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//&lt;ContainsExpression&gt; ::= &lt;ClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                        | &lt;ContainExpressionBoolean&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                        |&#39;(&#39; &lt;ContainExpressionBoolean&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-nl">containsExpression</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">containExpressionBool</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-nv">boolOp</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-o">)?</span><span class="tok-w"></span>
<span class="tok-c">// 	| &#39;(&#39; containExpressionBool &#39;)&#39; -&gt; ^(OPEN containExpressionBool)</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;ContainExpressionBoolean&gt; ::= &lt;ContainsExpression&gt; &#39;OR&#39; &lt;ContainsExpression&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &lt;ContainsExpression&gt; &#39;AND&#39; &lt;ContainsExpression&gt;</span><span class="tok-w"></span>
<span class="tok-c">//                              | &lt;ContainsExpression&gt; &#39;XOR&#39; &lt;ContainsExpression&gt;</span><span class="tok-w"></span>
<span class="tok-nl">containExpressionBool</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-nv">contains</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;(&#39;</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-w"> </span><span class="tok-s">&#39;)&#39;</span><span class="tok-w"> </span><span class="tok-o">-&gt;</span><span class="tok-w"> </span><span class="tok-o">^(</span><span class="tok-no">OPEN</span><span class="tok-w"> </span><span class="tok-nv">containsExpression</span><span class="tok-w"> </span><span class="tok-no">CLOSE</span><span class="tok-o">)</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">boolOp</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">OR</span><span class="tok-o">|</span><span class="tok-no">XOR</span><span class="tok-o">|</span><span class="tok-no">AND</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;ClassExpr&gt;::=   &lt;SimpleClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		   | &#39;(&#39; &lt;SimpleClassExpr&gt; &lt;ContainsExpr&gt; &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//		   | &lt;SimpleClassExpr&gt; &lt;ContainsExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//classExpr</span><span class="tok-w"></span>
<span class="tok-c">// 	: &#39;(&#39; simpleClassExpr &#39;)&#39;</span><span class="tok-w"></span>
<span class="tok-c">//	| simpleClassExpr</span><span class="tok-w"></span>
<span class="tok-c">//	;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;SimpleClassExpr&gt;::= Identifier							! RM_TYPE_NAME</span><span class="tok-w"></span>
<span class="tok-c">//               | Identifier Identifier					! RM_TYPE_NAME variable</span><span class="tok-w"></span>
<span class="tok-c">//               | &lt;ArchetypedClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 | &lt;VersionedClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 | &lt;VersionClassExpr&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 ! | &lt;IdentifiedObjectExpr&gt;                           ! need to be used once VersionedClassExpr is removed</span><span class="tok-w"></span>
<span class="tok-nl">simpleClassExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w">					</span><span class="tok-c">//! RM_TYPE_NAME .. RM_TYPE_NAME variable</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">archetypedClassExpr</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">versionedClassExpr</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-nv">versionClassExpr</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-c">//		 ! | &lt;IdentifiedObjectExpr&gt;                           ! need to be used once VersionedClassExpr is removed</span><span class="tok-w"></span>

<span class="tok-c">//&lt;ArchetypedClassExpr&gt;::= Identifier &lt;ArchetypePredicate&gt;	! RM_TYPE_NAME [archetype_id]</span><span class="tok-w"></span>
<span class="tok-c">//               | Identifier Identifier &lt;ArchetypePredicate&gt;	! RM_TYPE_NAME variable [archetype_id]</span><span class="tok-w"></span>
<span class="tok-nl">archetypedClassExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">archetypePredicate</span><span class="tok-p">;</span><span class="tok-w">	</span><span class="tok-c">//! RM_TYPE_NAME variable? [archetype_id]</span><span class="tok-w"></span>

<span class="tok-c">//! need to be used once VersionedClassExpr is removed</span><span class="tok-w"></span>
<span class="tok-c">//!&lt;IdentifiedObjectExpr&gt;::= Identifier &lt;StandardPredicate&gt;	! RM_TYPE_NAME [path operator operand]</span><span class="tok-w"></span>
<span class="tok-c">//!               | Identifier Identifier &lt;StandardPredicate&gt;	! RM_TYPE_NAME variable [path operator operand]</span><span class="tok-w"></span>
<span class="tok-c">//&lt;VersionedClassExpr&gt;::= &#39;VERSIONED_OBJECT&#39;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSIONED_OBJECT&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSIONED_OBJECT&#39; &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSIONED_OBJECT&#39; Identifier &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">versionedClassExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">VERSIONED_OBJECT</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-nv">standardPredicate</span><span class="tok-o">?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//&lt;VersionClassExpr&gt;::= &#39;VERSION&#39;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; Identifier</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; Identifier &lt;StandardPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//		 | &#39;VERSION&#39; &lt;VersionPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-c">//               | &#39;VERSION&#39; Identifier &lt;VersionPredicate&gt;</span><span class="tok-w"></span>
<span class="tok-nl">versionClassExpr</span><span class="tok-w"></span>
<span class="tok-w"> 	</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">VERSION</span><span class="tok-o">^</span><span class="tok-w"> </span><span class="tok-no">IDENTIFIER</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-nv">standardPredicate</span><span class="tok-o">|</span><span class="tok-nv">versionPredicate</span><span class="tok-o">)?</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//</span><span class="tok-w"></span>
<span class="tok-c">// LEXER PATTERNS</span><span class="tok-w"></span>
<span class="tok-c">//</span><span class="tok-w"></span>

<span class="tok-nl">WS</span><span class="tok-w">  </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-s">&#39; &#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;\t&#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;\r&#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;\n&#39;</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-nv">$channel</span><span class="tok-o">=</span><span class="tok-n">HIDDEN</span><span class="tok-o">;</span><span class="tok-p">}</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SELECT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;L&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;l&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">TOP</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;P&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;p&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">FORWARD</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;W&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;w&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">BACKWARD</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;K&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;k&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;W&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;w&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">AS</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">CONTAINS</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">WHERE</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;W&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;w&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;H&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;h&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ORDERBY</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39; &#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;Y&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;y&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">FROM</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;M&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;m&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">DESCENDING</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;G&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;g&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ASCENDING</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;G&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;g&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">DESC</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ASC</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">EHR</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&#39;EHR&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">AND</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">OR</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">XOR</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;X&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;x&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;R&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">NOT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;N&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;O&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;o&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">MATCHES</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;M&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;m&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;H&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;h&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">EXISTS</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;X&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;x&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;I&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;i&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;T&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">)(</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">VERSION</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;VERSION&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">VERSIONED_OBJECT</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;VERSIONED_OBJECT&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">ALL_VERSIONS</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;all_versions&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">ESC_SEQ</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;t&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;n&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;r&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&quot;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-no">UNICODE_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-no">OCTAL_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">OCTAL_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;3&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-o">|</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;7&#39;</span><span class="tok-o">)</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">UNICODE_ESC</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">:</span><span class="tok-w">   </span><span class="tok-s">&#39;\\&#39;</span><span class="tok-w"> </span><span class="tok-s">&#39;u&#39;</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-no">HEX_DIGIT</span><span class="tok-w"></span>
<span class="tok-w">    </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">HEX_DIGIT</span><span class="tok-w"> </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;9&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;F&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">QUOTE</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">DIGIT</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;0&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;9&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">HEXCHAR</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	 </span><span class="tok-no">DIGIT</span><span class="tok-o">|</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;c&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;C&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;d&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;D&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;e&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;E&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;f&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;F&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">LETTER</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;z&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;Z&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">ALPHANUM</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">LETTER</span><span class="tok-o">|</span><span class="tok-no">DIGIT</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">LETTERMINUSA</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;b&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;z&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;B&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;Z&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">LETTERMINUST</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;s&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;S&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;u&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;z&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;U&#39;</span><span class="tok-o">..</span><span class="tok-s">&#39;Z&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">IDCHAR</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ALPHANUM</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">IDCHARMINUST</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">LETTERMINUST</span><span class="tok-o">|</span><span class="tok-no">DIGIT</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">URISTRING</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">ALPHANUM</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;/&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;:&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;.&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;?&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;&amp;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;%&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;$&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;#&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;@&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;!&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;+&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;=&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;*&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-k">fragment</span><span class="tok-w"></span>
<span class="tok-nl">REGEXCHAR</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">URISTRING</span><span class="tok-o">|</span><span class="tok-s">&#39;(&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;)&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;^&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;{&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;}&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;]&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;[&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>


<span class="tok-c">// Terminal Definitions</span><span class="tok-w"></span>

<span class="tok-c">//Boolean     = &#39;true&#39; | &#39;false&#39;</span><span class="tok-w"></span>
<span class="tok-nl">BOOLEAN</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;true&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;false&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;TRUE&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;FALSE&#39;</span><span class="tok-w"> </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//!NodeId      = &#39;a&#39;&#39;t&#39;{Digit}{Digit}{Digit}{Digit}</span><span class="tok-w"></span>
<span class="tok-c">//! conflict with Identifier</span><span class="tok-w"></span>
<span class="tok-c">//!NodeId	     = &#39;at&#39;({Digit}{Digit}{Digit}{Digit}(&#39;.0&#39;*(&#39;.&#39;{NonZeroDigit}{Digit}*)+|(&#39;.&#39;{NonZeroDigit}{Digit}*)*)|&#39;0&#39;&#39;.0&#39;*(&#39;.&#39;{NonZeroDigit}{Digit}*)+|(&#39;.&#39;{NonZeroDigit}{Digit}*)+)</span><span class="tok-w"></span>
<span class="tok-c">//NodeId	     = &#39;at&#39;({Digit}+(&#39;.&#39;{Digit}+)*)</span><span class="tok-w"></span>
<span class="tok-c">//NODEID	:	&#39;at&#39; DIGIT+ (&#39;.&#39; DIGIT+)*;</span><span class="tok-w"></span>
<span class="tok-nl">NODEID</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;at&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+)*</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c">// DIGIT DIGIT DIGIT DIGIT;</span><span class="tok-w"></span>

<span class="tok-c">//!Identifier  = {Letter}({Alphanumeric}|&#39;_&#39;)*   ! Conflicts with UID</span><span class="tok-w"></span>
<span class="tok-c">//!Identifier  = {Letter}{IdChar}*   ! Conflicts with extended NodeId</span><span class="tok-w"></span>
<span class="tok-c">//! restricted to allow only letters after the 4th character due to conflict with extended NodeId</span><span class="tok-w"></span>
<span class="tok-c">//!Identifier  = {Letter}{IdChar}?{IdChar}?{IdChar}?({Letter}|&#39;_&#39;)*  !Conficts with NodeId which may have any length of digit, such as at0.9</span><span class="tok-w"></span>
<span class="tok-c">//Identifier = {LetterMinusA}{IdCharMinusT}?{IdChar}* | &#39;a&#39;&#39;t&#39;?(({letter}|&#39;_&#39;)*|{LetterMinusT}{Alphanumeric}*)</span><span class="tok-w"></span>
<span class="tok-c">// ???</span><span class="tok-w"></span>
<span class="tok-nl">IDENTIFIER</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-o">(</span><span class="tok-s">&#39;a&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;A&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">ALPHANUM</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-o">)*</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-o">|</span><span class="tok-w"> 	</span><span class="tok-no">LETTERMINUSA</span><span class="tok-w"> </span><span class="tok-no">IDCHAR</span><span class="tok-o">*</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//!PathItem = &#39;/&#39;{Letter}({Alphanumeric}|&#39;_&#39;)*</span><span class="tok-w"></span>

<span class="tok-c">//Integer     = {Digit}+</span><span class="tok-w"></span>
<span class="tok-nl">INTEGER</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//Float       = {Digit}+&#39;.&#39;{Digit}+</span><span class="tok-w"></span>
<span class="tok-nl">FLOAT</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//Date        = &#39;&#39;{Digit}{Digit}{Digit}{Digit}&#39;-&#39;{Digit}{Digit}&#39;-&#39;{Digit}{Digit}&#39;&#39;</span><span class="tok-w"></span>
<span class="tok-nl">DATE</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;T&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;+&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-w"> </span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//!Parameter   = &#39;$&#39;{letter}({Alphanumeric}|&#39;_&#39;)*</span><span class="tok-w"></span>
<span class="tok-c">//Parameter   = &#39;$&#39;{letter}{IdChar}*</span><span class="tok-w"></span>
<span class="tok-nl">PARAMETER</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;$&#39;</span><span class="tok-w"> </span><span class="tok-no">LETTER</span><span class="tok-w"> </span><span class="tok-no">IDCHAR</span><span class="tok-o">*</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! could constrain UID further</span><span class="tok-w"></span>
<span class="tok-c">//UniqueId    = {digit}+(&#39;.&#39;{digit}+)+&#39;.&#39;{digit}+  ! OID</span><span class="tok-w"></span>
<span class="tok-c">//          | {Hex Char}+(&#39;-&#39;{Hex Char}+)+       ! UUID</span><span class="tok-w"></span>
<span class="tok-nl">UNIQUEID</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+)+</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w">  </span><span class="tok-c">// OID</span><span class="tok-w"></span>
<span class="tok-w">            </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-no">HEXCHAR</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-no">HEXCHAR</span><span class="tok-o">+)+</span><span class="tok-w">       </span><span class="tok-c">// UUID</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//! could constrain ArchetypeId further</span><span class="tok-w"></span>
<span class="tok-c">//!ArchetypeId = {Letter}+&#39;-&#39;{Letter}+&#39;-&#39;({Letter}|&#39;_&#39;)+&#39;.&#39;({Letter}|&#39;_&#39;|&#39;-&#39;)+&#39;.v&#39;{Digit}+(&#39;.&#39;{Digit}+)?  ! not allow a number in archetype id concept, such as openEHR-EHR-OBSERVATION.laboratory-hba1c.v1</span><span class="tok-w"></span>
<span class="tok-c">//ArchetypeId = {Letter}+&#39;-&#39;{Letter}+&#39;-&#39;({Letter}|&#39;_&#39;)+&#39;.&#39;({IdChar}|&#39;-&#39;)+&#39;.v&#39;{Digit}+(&#39;.&#39;{Digit}+)?</span><span class="tok-w"></span>
<span class="tok-nl">ARCHETYPEID</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-no">LETTER</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-no">LETTER</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;-&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">LETTER</span><span class="tok-o">|</span><span class="tok-s">&#39;_&#39;</span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">IDCHAR</span><span class="tok-o">|</span><span class="tok-s">&#39;-&#39;</span><span class="tok-o">)+</span><span class="tok-w"> </span><span class="tok-s">&#39;.v&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-s">&#39;.&#39;</span><span class="tok-w"> </span><span class="tok-no">DIGIT</span><span class="tok-o">+)?</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//ComparableOperator = &#39;=&#39; | &#39;!=&#39; | &#39;&gt;&#39; | &#39;&gt;=&#39; | &#39;&lt;&#39; | &#39;&lt;=&#39;</span><span class="tok-w"></span>
<span class="tok-nl">COMPARABLEOPERATOR</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;!=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&gt;&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&gt;=&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&lt;&#39;</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-s">&#39;&lt;=&#39;</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//UriValue   = {Letter}+&#39;://&#39;({UriString}|&#39;[&#39;|&#39;]&#39;|&#39;, &#39;&#39;&#39;|&#39;&#39;)*</span><span class="tok-w"></span>
<span class="tok-c">//            |{Letter}+&#39;:&#39;({UriString}|&#39;[&#39;|&#39;]&#39;|&#39;&#39;)*</span><span class="tok-w"></span>
<span class="tok-nl">URIVALUE</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-no">LETTER</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;://&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-no">URISTRING</span><span class="tok-o">|</span><span class="tok-s">&#39;[&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;]&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;, \&#39;&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-o">)*</span><span class="tok-w"></span>
<span class="tok-c">//	| LETTER+ &#39;:&#39; (URISTRING|&#39;[&#39;|&#39;]&#39;|&#39;\&#39;&#39;)*</span><span class="tok-w"></span>
<span class="tok-w">        </span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//RegExPattern = &#39;{/&#39;{RegExChar}+&#39;/}&#39;</span><span class="tok-w"></span>
<span class="tok-nl">REGEXPATTERN</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;{/&#39;</span><span class="tok-w"> </span><span class="tok-no">REGEXCHAR</span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&#39;/}&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-c">//String      = &#39;&quot;&#39;{String Char}*&#39;&quot;&#39;</span><span class="tok-w"></span>
<span class="tok-w">  </span><span class="tok-c">//          | &#39;&#39;{String Char}*&#39;&#39;</span><span class="tok-w"></span>
<span class="tok-nl">STRING</span><span class="tok-w"></span>
<span class="tok-w">    	</span><span class="tok-p">:</span><span class="tok-w">  </span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">ESC_SEQ</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-o">~(</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">)*</span><span class="tok-w"> </span><span class="tok-s">&#39;\&#39;&#39;</span><span class="tok-w"></span>
<span class="tok-w">    	</span><span class="tok-o">|</span><span class="tok-w">  </span><span class="tok-s">&#39;&quot;&#39;</span><span class="tok-w"> </span><span class="tok-o">(</span><span class="tok-w"> </span><span class="tok-no">ESC_SEQ</span><span class="tok-w"> </span><span class="tok-o">|</span><span class="tok-w"> </span><span class="tok-o">~(</span><span class="tok-s">&#39;\\&#39;</span><span class="tok-o">|</span><span class="tok-s">&#39;&quot;&#39;</span><span class="tok-o">)</span><span class="tok-w"> </span><span class="tok-o">)*</span><span class="tok-w"> </span><span class="tok-s">&#39;&quot;&#39;</span><span class="tok-w"></span>
<span class="tok-w">    	</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">SLASH</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;/&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">COMMA</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;,&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">OPENBRACKET</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;[&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">CLOSEBRACKET</span><span class="tok-w"></span>
<span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;]&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>

<span class="tok-nl">OPEN</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;(&#39;</span><span class="tok-p">;</span><span class="tok-w"></span>
<span class="tok-nl">CLOSE</span><span class="tok-w">	</span><span class="tok-p">:</span><span class="tok-w">	</span><span class="tok-s">&#39;)&#39;</span><span class="tok-p">;</span><span class="tok-w"></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2018-12-10 22:23:25 GMT
</div>
</div>
</body>
</html>